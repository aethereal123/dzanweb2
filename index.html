<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aether Situs Kaga Jelas Anjir</title>
  <link rel="icon" type="image/jpeg" href="site.jpg"> 
  <link href="https://fonts.googleapis.com/css2?family=Cal+Sans:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Creepster&display=swap" rel="stylesheet">
  <style>
    /* Global Variables */
    :root {
      --font-primary: 'Cal Sans', sans-serif;
      --font-creepy: 'Creepster', cursive;

      /* Light Theme */
      --bg-gradient-light: linear-gradient(to bottom, #87CEEB, #f0f8ff);
      --bg-main-light: rgba(255, 255, 255, 0.8);
      --text-color-light: #333;
      --heading-color-light: #007BFF;
      --button-bg-light: #007BFF;
      --button-text-light: #fff;
      --button-hover-bg-light: #0056b3;
      --widget-bg-light: rgba(0, 0, 0, 0.5);
      --widget-text-light: white;
      --widget-shadow-light: 0 0 10px white;
      --calc-display-bg-light: rgba(255,255,255,0.2);
      --calc-btn-bg-light: rgba(255,255,255,0.2);
      --calc-btn-hover-bg-light: rgba(255,255,255,0.5);
      --calc-clear-bg-light: rgba(255,0,0,0.7);
      --intro-text-color-light: #333;
      --story-text-color-light: #333; /* Initial value, can be overridden by dark mode JS logic */

      /* Player Base Variables - will be overridden by specific themes */
      --player-bg-color: #777;
      --player-glow-color: transparent;
      --player-text-color: white;
      --player-main-box-bg: transparent;
      --player-main-box-text-color: white;
      --player-track-title-color: white;
      --player-track-artist-color: #f0f0f0;
      --player-time-display-color: #e0e0e0;
      --player-seekbar-track-color: rgba(255,255,255,.3);
      --player-seekbar-track-hover-color: rgba(255,255,255,.5);
      --player-seekbar-thumb-color: white;
      --player-seekbar-thumb-shadow-color: rgba(255,255,255,.9);
      --player-button-bg: transparent;
      --player-button-text-color: white;
      --player-button-border-color: white;
      --player-button-hover-bg: rgba(255,255,255,.2);
      --player-playpause-button-bg: var(--player-seekbar-thumb-color);
      --player-playpause-button-text-color: white; /* JS may adjust contrast */
      --player-logo-spin-animation: spin-default; /* Default spin or none if overridden */

      /* Dark Mode Toggle */
      --dm-toggle-bg-light: #FFF;
      --dm-toggle-border-light: #FFC107;
      --dm-toggle-icon-bg-light: #FFC107;
      --dm-toggle-icon-shadow-light: 0 0 10px rgba(255, 193, 7, 0.7);

      /* Specific Dark Mode Toggle Styles in Dark Mode Block */
    }

    /* Default Spin Animation (can be overridden) */
    @keyframes spin-default { 0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)} }

    /* --- NEW ANIMATIONS --- */
    @keyframes fadeInBody {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes animatedMainBackgroundGradient {
        0% { background-position: 0% 0%; }
        100% { background-position: 0% 100%; }
    }

    @keyframes animatedDarkMainBackground {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }

    @keyframes fadeInWidget {
      from { opacity: 0; transform: scale(0.9) translateY(-10px); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }

    @keyframes popInPlayer {
        from { opacity: 0; transform: scale(0.85) translateY(15px); }
        to { opacity: 1; transform: scale(1) translateY(0); }
    }
    
    @keyframes textFocusIn {
      0% { filter: blur(12px); opacity: 0; transform: translateY(10px);}
      100% { filter: blur(0); opacity: 1; transform: translateY(0);}
    }

    @keyframes calcButtonPressed {
        0% { transform: scale(1); }
        50% { transform: scale(0.92); box-shadow: 0 0 3px var(--widget-text-light), inset 0 0 5px rgba(0,0,0,0.2); }
        100% { transform: scale(1); }
    }
    /* ANIMASI BARU UNTUK DATE TIME WIDGET */
    @keyframes dateTimeWidgetClickAnimation {
        0% {
            transform: scale(1) rotate(0deg);
            filter: brightness(100%) saturate(100%) hue-rotate(0deg);
            box-shadow: var(--widget-shadow-light); /* Akan menggunakan var dark jika dark mode aktif */
        }
        20% {
            transform: scale(1.15) rotate(5deg);
            filter: brightness(130%) saturate(200%) hue-rotate(45deg);
            box-shadow: 0 0 15px gold, 0 0 25px yellow;
        }
        40% {
            transform: scale(0.9) rotate(-5deg);
            filter: brightness(90%) saturate(150%) hue-rotate(-45deg);
            box-shadow: 0 0 15px dodgerblue, 0 0 25px cyan;
        }
        60% {
            transform: scale(1.1) rotate(3deg) translateX(5px);
            filter: brightness(120%) saturate(180%) hue-rotate(90deg);
            box-shadow: 0 0 20px limegreen, 0 0 30px springgreen;
        }
        80% {
            transform: scale(0.95) rotate(-2deg) translateX(-5px);
            filter: brightness(95%) saturate(120%) hue-rotate(-90deg);
            box-shadow: 0 0 15px hotpink, 0 0 25px lightpink;
        }
        100% {
            transform: scale(1) rotate(0deg);
            filter: brightness(100%) saturate(100%) hue-rotate(0deg);
            box-shadow: var(--widget-shadow-light); /* Kembali ke shadow normal */
        }
    }
    .date-time-animate {
        animation: dateTimeWidgetClickAnimation 0.9s cubic-bezier(0.25, 0.1, 0.25, 1);
    }
    /* --- END NEW ANIMATIONS --- */


    /* Global Styles */
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
    }
    html {
      scroll-behavior: smooth;
    }
    body { 
      font-family: var(--font-primary); 
      background: var(--bg-gradient-light); /* Fallback, actual background controlled by #fire-background */
      color: var(--text-color-light);
      transition: background-color 0.5s ease, background-image 0.5s ease, color 0.5s ease;
      min-height: 100vh;
      overflow-x: hidden; 
      position: relative;
      animation: fadeInBody 1.2s ease-in-out forwards; /* NEW Animation */
    }

    /* CSS UNTUK MEMBLOKIR INTERAKSI SAAT VIDEO YOUTUBE MUNCUL */
    body.youtube-video-active {
        overflow: hidden !important; /* Mencegah scroll halaman di belakang overlay */
    }
    body.youtube-video-active > *:not(#youtube-video-overlay) {
        pointer-events: none !important; /* Menonaktifkan klik pada semua elemen kecuali overlay video */
        /* filter: blur(3px); /* Optional: tambahkan blur untuk efek visual */
        /* opacity: 0.7; /* Optional: kurangi opacity elemen di belakang */
    }
    #youtube-video-overlay {
        /* Pastikan overlay video bisa diinteraksi jika ada kontrol custom (meskipun di sini tidak ada) */
        pointer-events: auto;
    }


    /* Layout & Core Content Sections */
    #intro { 
      display: flex; 
      flex-direction: column; 
      justify-content: center; 
      align-items: center; 
      min-height: 100vh; 
      text-align: center; 
      padding: 20px; 
      background: var(--bg-main-light); 
      box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
      opacity: 1; 
      transition: opacity 1s ease-out, transform 1s ease-out; 
      pointer-events: auto; 
      user-select: none; 
    }
    #intro.is-exiting { 
      opacity: 0; 
      transform: scale(0.8) rotate(-5deg); 
      pointer-events: none;
    }
    main { 
      padding: 20px; 
      max-width: 800px; 
      margin: 0 auto; 
      text-align: center; 
      background: var(--bg-main-light); 
      border-radius: 10px; 
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); 
      position: relative; 
      opacity: 0; 
      transform: translateY(50px); 
      display: none; 
      pointer-events: auto; 
      user-select: none; 
    }
    main.is-entering { 
      display: block !important; 
      animation: slideInFromBottom 0.8s ease-out forwards; 
      animation-delay: 0.3s; 
    }
    @keyframes slideInFromBottom { 
      from { opacity: 0; transform: translateY(50px); } 
      to { opacity: 1; transform: translateY(0); } 
    }

    /* Typography within Intro & Main */
    #intro h1 {
      animation: textFocusIn 1s cubic-bezier(0.550, 0.085, 0.680, 0.530) 0.5s both; /* NEW Animation */
    }
    main.is-entering #story h2 {
        animation: textFocusIn 0.8s cubic-bezier(0.550, 0.085, 0.680, 0.530) 0.7s both; /* NEW Animation, delayed */
    }
    #intro h1, #story h2 { 
      font-size: 2.5rem; 
      margin-bottom: 20px; 
      color: var(--heading-color-light); 
      font-weight: 700;
      user-select: auto; 
    }
    #story h2 { font-size: 2rem; }
    
    #intro p, #story-text-content {
      font-size: 1.2rem; 
      margin-bottom: 20px; 
      line-height: 1.6;
      color: var(--intro-text-color-light); 
      white-space: pre-wrap; 
      word-wrap: break-word; 
      overflow-wrap: break-word; 
      -webkit-hyphens: auto; 
      -ms-hyphens: auto;    
      hyphens: auto;   
      user-select: none; 
      pointer-events: none; 
    }
    #story-text-content {
        text-align: left; 
        color: var(--story-text-color-light); 
    }
    
    button, a, img, input[type="range"], input[type="text"], textarea, label,
    select, details, summary, [contenteditable="true"], [tabindex]:not([tabindex="-1"]) { 
      pointer-events: auto; 
      user-select: auto; 
      cursor: pointer; 
    }
    input[type="text"], textarea { 
        user-select: text;
        cursor: text;
    }

    #intro button, #next-button { 
      background: var(--button-bg-light); 
      color: var(--button-text-light); 
      border: none; 
      padding: 10px 20px; 
      font-size: 1rem; 
      font-family: inherit; 
      border-radius: 5px; 
      transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease; 
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    #intro button:hover, #next-button:hover:not(:disabled) { 
      background: var(--button-hover-bg-light); 
      transform: scale(1.05) translateY(-2px); /* Enhanced hover */
      box-shadow: 0 6px 12px rgba(0,0,0,0.2); /* Enhanced hover shadow */
    }
    #next-button:disabled {
        background-color: #cccccc !important; 
        color: #666666 !important;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }

    #aetherx-logo { 
      width: 100px; 
      height: auto; 
      animation: pulseLogo 2.5s infinite ease-in-out; 
      margin-bottom: 20px; 
      transition: filter 0.3s ease;
    }
    #aetherx-link:hover #aetherx-logo { 
      filter: drop-shadow(0 0 15px rgba(120, 190, 255, 1));
    }
    @keyframes pulseLogo { 
      0%, 100% { transform: scale(1); filter: drop-shadow(0 0 3px rgba(75,150,255,.5)); } 
      50% { transform: scale(1.05); filter: drop-shadow(0 0 10px rgba(100,175,255,.8)); } 
    }

    #dark-mode-toggle {
      position: fixed; top: 10px; left: 10px; z-index: 1001; 
      background-color: var(--dm-toggle-bg-light);
      border: 2px solid var(--dm-toggle-border-light); 
      border-radius: 50%; width: 48px; height: 48px;
      outline: none; display: flex; justify-content: center; align-items: center;
      transition: background-color 0.5s ease, border-color 0.5s ease, transform 0.3s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15); overflow: hidden;
    }
    #dark-mode-toggle:hover { transform: scale(1.1) rotate(15deg); }
    #dark-mode-toggle .toggle-icon {
      display: block; width: 24px; height: 24px; border-radius: 50%;
      background-color: var(--dm-toggle-icon-bg-light); 
      position: relative;
      transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
      box-shadow: var(--dm-toggle-icon-shadow-light);
      pointer-events: none; 
    }

    /* Widgets (Date/Time, Calculator) */
    .widget {
      position: fixed; 
      font-family: var(--font-primary); 
      color: var(--widget-text-light);
      background: var(--widget-bg-light); 
      padding: 10px; border-radius: 5px;
      box-shadow: var(--widget-shadow-light); 
      z-index: 1000; 
      user-select: none; 
      text-align: center;
      backdrop-filter: blur(5px); 
      transition: background-color 0.3s ease, box-shadow 0.3s ease, opacity 0.5s ease-out, transform 0.5s ease-out; /* Added opacity/transform transition */
      opacity: 0; /* For animation */
      transform: translateY(-20px); /* For animation */
      pointer-events: auto; 
    }
    .widget * { 
        pointer-events: auto; 
        user-select: auto; 
    }
    /* NEW class for widget animation */
    .widget.widget-active {
        opacity: 1;
        transform: translateY(0);
        animation: fadeInWidget 0.6s ease-out forwards; /* Can also be used if transition preferred, just remove animation */
        animation-delay: 0.5s; /* Stagger slightly after main content slides in */
    }

    #date-time-logo { 
      top: 10px; left: 70px; font-size: 1.2rem; padding: 5px 10px;
    }
    #countdown { 
      font-size: 0.9rem; text-shadow: 0 0 5px var(--widget-text-light); margin-top: 5px; 
      user-select: none; pointer-events: none; 
    }
    #calculator { 
      top: 10px; right: 10px; width: 200px; font-size: 1rem; 
    }
    #calc-display { 
      background: var(--calc-display-bg-light); 
      font-size: 1.5rem; padding: 10px; border-radius: 5px; 
      margin-bottom: 10px; text-align: right; 
      box-shadow: inset 0 0 5px var(--widget-text-light);
      min-height: 2.5em; 
      line-height: 1.5em;
      word-break: break-all; 
      user-select: none; pointer-events: none; 
    }
    #calc-buttons { 
      display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; 
    }
    #calc-buttons button { 
      background: var(--calc-btn-bg-light); 
      font-size: 1rem; padding: 10px; border: none; border-radius: 5px; 
      box-shadow: 0 0 5px var(--widget-text-light); 
      transition: background-color 0.3s ease, transform 0.1s ease; 
      color: var(--widget-text-light); 
      font-family: var(--font-primary);
      font-weight: bold;
    }
    #calc-buttons button:hover { 
      background: var(--calc-btn-hover-bg-light); 
      transform: translateY(-1px);
    }
    #calc-buttons button:active {
      transform: translateY(1px) scale(0.95); /* Added scale for more feedback */
    }
    #calc-buttons button.pressed-animation { /* NEW Animation class */
        animation: calcButtonPressed 0.2s ease-out;
    }
    #calc-buttons #clear { 
      grid-column: span 4; background: var(--calc-clear-bg-light); 
    }

    /* Scary Overlay & Fire Background */
    #scary-text-overlay, #fire-background { 
      user-select: none; 
      pointer-events: none; 
    }
    #scary-text-overlay { 
      position: fixed; top: 50%; left: 50%; 
      transform: translate(-50%, -50%); 
      font-family: var(--font-creepy); 
      font-size: 5rem; color: red; 
      text-shadow: 0 0 10px red,0 0 20px red,0 0 30px red; 
      z-index: 20000; display: none; 
      animation: fadeInOutScary 0.5s ease-in-out;
    }
    @keyframes fadeInOutScary {
      0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
      50% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
      100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
    }
    #fire-background { 
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
      overflow: hidden; z-index: -2; 
      background: var(--bg-gradient-light);
      /* NEW ANIMATION for background gradient */
      background-size: 100% 300%;
      animation: animatedMainBackgroundGradient 20s ease infinite alternate;
      transition: background-image 0.5s ease, background-color 0.5s ease; /* Retain dark mode transition */
    }
    .fire-number { 
      position: absolute; font-size: 2rem; font-family: var(--font-primary); 
      color: white; text-shadow: 0 0 10px white,0 0 20px white,0 0 30px white; 
      animation: rise 3s linear infinite, flicker 0.1s infinite; 
    }
    @keyframes rise { 
      0% { transform: translateY(100vh) scale(1); opacity: 1; } 
      100% { transform: translateY(-10vh) scale(0.5); opacity: 0; } 
    }
    @keyframes flicker { 
      0%, 100% { opacity: 0.8; } 
      50% { opacity: 1; } 
    }

    /* Base Music Player Styles */
    .music-player-container {
      display: none; 
      align-items: center;
      padding: 20px;
      border-radius: 15px;
      margin: 30px auto;
      font-family: var(--font-primary);
      width: 95%;
      max-width: 420px;
      background: var(--player-bg-color); 
      color: var(--player-text-color); 
      box-shadow: var(--player-glow-color) 0px 0px 15px, var(--player-glow-color) 0px 0px 20px, var(--player-glow-color) 0px 0px 30px;
      transition: background-color 0.3s ease, box-shadow 0.3s ease, color 0.3s ease, opacity 0.5s ease-out, transform 0.5s ease-out;
      pointer-events: auto; 
      user-select: none; 
      opacity: 0; /* For animation, set to 1 by animation */
    }
    /* NEW class for player animation */
    .music-player-container.player-active-animation {
        animation: popInPlayer 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
         opacity: 1; /* Ensure it's visible after animation */
    }

    .player-logo-wrapper { 
      position: relative; width: 70px; height: 70px; 
      margin-right: 20px; flex-shrink: 0; 
      user-select: auto; pointer-events: auto; 
    }
    .player-logo-background { 
      width: 100%; height: 100%; 
      background-color: rgba(255,255,255,.2); 
      border-radius: 50%; 
      position: absolute; top: 0; left: 0; z-index: 1; 
      box-shadow: 0 0 10px rgba(255,255,255,.3); 
      pointer-events: none; 
    }
    .player-logo-background.playing { 
      animation-name: var(--player-logo-spin-animation);
      animation-duration: 3s; 
      animation-timing-function: linear; 
      animation-iteration-count: infinite; 
    }
    /* Specific Spin Animations, referenced by --player-logo-spin-animation */
    @keyframes spin-fuchsia  { 0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)} }
    @keyframes spin-emerald  { 0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)} }
    @keyframes spin-burgundy { 0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)} }
    @keyframes spin-ivory    { 0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)} }
    @keyframes spin-secret-song-player { 0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)} }
    
    .player-aetherx-logo { 
      width: 85%; height: 85%; 
      position: absolute; top: 50%; left: 50%; 
      transform: translate(-50%, -50%); 
      border-radius: 50%; z-index: 2; 
    }
    .player-main { 
      width: 100%; display: flex; flex-direction: column; 
      align-items: center; flex-grow: 1; 
      background-color: var(--player-main-box-bg); 
      color: var(--player-main-box-text-color); 
      padding: 15px; border-radius: 10px; 
      box-shadow: inset 0 0 10px rgba(0,0,0,.1); 
      pointer-events: none; 
      user-select: none;
    }
    .track-info { 
      text-align: center; margin-bottom: 10px; min-height: 45px; 
      user-select: none; pointer-events: none; 
    }
    .track-info span:first-child { 
      font-size: 1.1rem; font-weight: bold; display: block; 
      color: var(--player-track-title-color); 
    }
    .track-info span:last-child { 
      font-size: .9rem; 
      color: var(--player-track-artist-color); 
    }
    .player-seek-bar { 
      width: 100%; margin: 10px 0; 
      -webkit-appearance: none; appearance: none; 
      height: 8px; border-radius: 4px; outline: none; 
      transition: background .2s ease; 
      background: var(--player-seekbar-track-color); 
    }
    .player-seek-bar:hover {
      background: var(--player-seekbar-track-hover-color); 
    }
    .player-seek-bar::-webkit-slider-thumb { 
      -webkit-appearance: none; appearance: none; 
      width: 16px; height: 16px; border-radius: 50%; 
      background: var(--player-seekbar-thumb-color); 
      box-shadow: 0 0 8px var(--player-seekbar-thumb-shadow-color); 
    }
    .player-seek-bar::-moz-range-thumb { 
      width: 16px; height: 16px; border-radius: 50%; border: none; 
      background: var(--player-seekbar-thumb-color); 
      box-shadow: 0 0 8px var(--player-seekbar-thumb-shadow-color); 
    }
    .time-display { 
      font-size: .8rem; width: 100%; display: flex; 
      justify-content: space-between; padding: 0 5px; margin-bottom: 15px; 
      color: var(--player-time-display-color); 
      user-select: none; pointer-events: none; 
    }
    .player-controls { 
      display: flex; justify-content: center; align-items: center; gap: 20px; 
      pointer-events: auto; user-select: none; 
    }
    .player-controls button { 
      font-size: 1.3rem; 
      padding: 8px; 
      border-radius: 50%; width: 40px; height: 40px; 
      display: flex; justify-content: center; align-items: center; 
      transition: background-color .2s ease,transform .2s ease,box-shadow .2s ease; 
      background: var(--player-button-bg); 
      border: 1px solid var(--player-button-border-color); 
      color: var(--player-button-text-color); 
      box-shadow: 0 0 5px var(--player-button-border-color); 
    }
    .player-controls button:hover:not(:disabled) { 
      transform: scale(1.1); 
      background-color: var(--player-button-hover-bg); 
      box-shadow: 0 0 10px var(--player-button-border-color); 
    }
    .player-controls button.play-pause-btn { 
      font-size: 1.8rem; width: 50px; height: 50px;
      background: var(--player-playpause-button-bg); 
      color: var(--player-playpause-button-text-color); 
    }
    .player-controls button.play-pause-btn:hover:not(:disabled) {
       filter: brightness(1.1);
    }
    .player-controls button:disabled { 
      opacity: .5; cursor: not-allowed; box-shadow: none; transform: none;
    }

    /* YouTube Video Overlay */
    #youtube-video-overlay { 
      position:fixed; top:0; left:0; width:100vw; height:100vh; 
      background-color:black; z-index:30000; 
      display:none; justify-content:center; align-items:center; overflow:hidden;
      pointer-events:auto; /* Diatur oleh JS, tapi defaultnya auto untuk overlay */
    }
    #youtube-player-container { 
      width:100%; height:100%; position:relative; 
      pointer-events:none; /* Biarkan iframe di dalamnya yang menangkap event */
    } 
    #youtube-player-container iframe { 
      position:absolute; top:0; left:0; width:100%; height:100%; border:0; 
      pointer-events:auto; /* Penting agar iframe bisa dikontrol jika perlu (meski kontrol dimatikan) */
    }

    /* Morse Code Overlay */
    #morse-code-overlay { 
      position:fixed; top:0; left:0; width:100%; height:100%; 
      background-color:rgba(0,0,0,.9); color:red; 
      font-family:'Courier New',Courier,monospace; font-size:1.5rem; 
      display:none; justify-content:center; align-items:center; text-align:center; 
      z-index:40000; padding:20px; white-space:pre-wrap; 
      line-height:1.6; opacity:0; animation:fadeInMorse .5s forwards;
      pointer-events:auto; 
      user-select:text; 
    }
    @keyframes fadeInMorse { to { opacity:1 } }

    /* === Dark Mode === */
    body.dark-mode {
      --bg-gradient-dark: none; 
      --bg-color-dark: #121212;
      --bg-main-dark: #1e1e1e;
      --text-color-dark: #e0e0e0;
      --heading-color-dark: #bb86fc;
      --button-bg-dark: #3700b3; 
      --button-text-dark: #e0e0e0; 
      --button-hover-bg-dark: #2a008c;
      --widget-bg-dark: rgba(40,40,40,.85); 
      --widget-text-dark: #e0e0e0;
      --widget-shadow-dark: 0 0 10px rgba(200,200,200,.3);
      --calc-display-bg-dark: rgba(80,80,80,.5); 
      --calc-btn-bg-dark: rgba(80,80,80,.5);
      --calc-btn-hover-bg-dark: rgba(100,100,100,.7);
      --calc-clear-bg-dark: rgba(170,0,0,0.85); 
      --intro-text-color-dark: #b0b0b0;
      --story-text-color-dark: #b0b0b0; 

      --dm-toggle-bg-dark: #2c3e50;
      --dm-toggle-border-dark: #76abcf;
      --dm-toggle-icon-shadow-dark: 0 0 10px rgba(224, 224, 224, 0.5);

      --player-main-box-bg-dark: #2a2a2a;
      --player-main-box-text-color-dark: #e0e0e0;
      --player-track-title-color-dark: #bb86fc;
      --player-track-artist-color-dark: #b0b0b0;
      --player-time-display-color-dark: #b0b0b0;
    }
    body.dark-mode { 
      background-image: var(--bg-gradient-dark); 
      background-color: var(--bg-color-dark); 
      color: var(--text-color-dark); 
    }
    body.dark-mode #fire-background { 
      background-image: radial-gradient(ellipse at center, rgba(50, 50, 70, 0.2) 0%, transparent 70%); /* MODIFIED for subtle dark effect */
      background-color: var(--bg-color-dark);
      background-size: 150% 150%;
      animation: animatedDarkMainBackground 25s linear infinite alternate; /* MODIFIED Dark background animation */
    }
    body.dark-mode #intro, body.dark-mode main { 
      background: var(--bg-main-dark); 
      box-shadow:0 4px 8px rgba(255,255,255,.05); 
    }
    body.dark-mode #intro h1, body.dark-mode #story h2 { 
      color: var(--heading-color-dark); 
    }
    body.dark-mode #intro button, body.dark-mode #next-button { 
      color: var(--button-text-dark); 
      background: var(--button-bg-dark); 
    }
     body.dark-mode #intro p { 
      color: var(--intro-text-color-dark);
    }
    /* Gunakan var --widget-shadow-dark untuk animasi date-time di dark mode */
    body.dark-mode .date-time-animate {
        animation-name: dateTimeWidgetClickAnimation; /* Pastikan animasi yang sama digunakan */
         box-shadow: var(--widget-shadow-dark); /* Default shadow untuk dark mode */
    }
    body.dark-mode .date-time-animate {
    /* Menggunakan animasi yang dikhususkan untuk dark mode */
    animation: dateTimeWidgetClickAnimationDark 0.9s cubic-bezier(0.25, 0.1, 0.25, 1);
}

@keyframes dateTimeWidgetClickAnimationDark {
    0% {
        transform: scale(1) rotate(0deg);
        filter: brightness(100%) saturate(100%) hue-rotate(0deg);
        box-shadow: var(--widget-shadow-dark);
    }
    20% {
        transform: scale(1.15) rotate(5deg);
        filter: brightness(115%) saturate(160%) hue-rotate(45deg);
        box-shadow: 0 0 15px rgba(200, 160, 50, 0.7), 0 0 25px rgba(220, 220, 200, 0.6); /* Muted gold / soft light */
    }
    40% {
        transform: scale(0.9) rotate(-5deg);
        filter: brightness(95%) saturate(130%) hue-rotate(-45deg);
        box-shadow: 0 0 15px rgba(70, 130, 180, 0.7), 0 0 25px rgba(100, 170, 220, 0.6); /* Steel blue / soft cyan-blue */
    }
    60% {
        transform: scale(1.1) rotate(3deg) translateX(5px);
        filter: brightness(110%) saturate(150%) hue-rotate(90deg);
        box-shadow: 0 0 20px rgba(100, 180, 100, 0.7), 0 0 30px rgba(150, 210, 150, 0.6); /* Muted green / light desaturated green */
    }
    80% {
        transform: scale(0.95) rotate(-2deg) translateX(-5px);
        filter: brightness(100%) saturate(120%) hue-rotate(-90deg);
        box-shadow: 0 0 15px rgba(170, 110, 170, 0.7), 0 0 25px rgba(200, 170, 200, 0.6); /* Muted orchid / soft lavender */
    }
    100% {
        transform: scale(1) rotate(0deg);
        filter: brightness(100%) saturate(100%) hue-rotate(0deg);
        box-shadow: var(--widget-shadow-dark);
    }
}

    body.dark-mode #intro button:hover, body.dark-mode #next-button:hover:not(:disabled) { 
      background: var(--button-hover-bg-dark); 
      /* Enhanced hover already applied globally */
    }
    body.dark-mode .widget { 
      background: var(--widget-bg-dark); 
      color: var(--widget-text-dark);
      box-shadow: var(--widget-shadow-dark); 
    }
    body.dark-mode #countdown { text-shadow: 0 0 5px var(--widget-text-dark); }
    body.dark-mode #calc-display { 
      background: var(--calc-display-bg-dark); 
      box-shadow: inset 0 0 5px var(--widget-text-dark); 
    }
    body.dark-mode #calc-buttons button { 
      background: var(--calc-btn-bg-dark); 
      color: var(--widget-text-dark);
      box-shadow:0 0 5px rgba(200,200,200,.2); 
    }
    body.dark-mode #calc-buttons button:hover { 
      background: var(--calc-btn-hover-bg-dark); 
    }
    body.dark-mode #calc-buttons #clear { 
      background: var(--calc-clear-bg-dark); 
    }
    body.dark-mode #dark-mode-toggle { 
      background-color: var(--dm-toggle-bg-dark); 
      border-color: var(--dm-toggle-border-dark); 
      box-shadow: 0 2px 8px rgba(255,255,255,0.1); 
    }
    body.dark-mode #dark-mode-toggle .toggle-icon {
      background-color: transparent; width: 20px; height: 20px; border: 5px solid #E0E0E0;
      border-left-color: transparent; border-top-color: transparent;
      transform: translateX(5px) rotate(45deg); 
      box-shadow: var(--dm-toggle-icon-shadow-dark);
    }
    body.dark-mode .player-main {
        background-color: var(--player-main-box-bg-dark, var(--player-main-box-bg));
        color: var(--player-main-box-text-color-dark, var(--player-main-box-text-color));
    }
    body.dark-mode .track-info span:first-child {
        color: var(--player-track-title-color-dark, var(--player-track-title-color));
    }
    body.dark-mode .track-info span:last-child {
        color: var(--player-track-artist-color-dark, var(--player-track-artist-color));
    }
    body.dark-mode .time-display {
        color: var(--player-time-display-color-dark, var(--player-time-display-color));
    }

    body.dark-mode .player-controls-emerald button, body.dark-mode .player-controls-burgundy button, body.dark-mode .player-controls-ivory button, body.dark-mode .player-controls-secret-song-player button { background:#3c3c3c; border-color:#555; color:#e0e0e0; }
    body.dark-mode .player-controls-emerald button:hover:not(:disabled), body.dark-mode .player-controls-burgundy button:hover:not(:disabled), body.dark-mode .player-controls-ivory button:hover:not(:disabled), body.dark-mode .player-controls-secret-song-player button:hover:not(:disabled) { background-color:#4f4f4f; }
    body.dark-mode .player-controls-emerald button#play-pause-button-emerald.play-pause-btn { background-color:#388E3C; } 
    body.dark-mode .player-controls-burgundy button#play-pause-button-burgundy.play-pause-btn { background-color:#6A001A; }
    body.dark-mode .player-controls-ivory button#play-pause-button-ivory.play-pause-btn { background-color:#607D8B; }

    #player-logo-wrapper-emerald, #player-logo-wrapper-burgundy, #player-logo-wrapper-ivory, #player-logo-wrapper-secret-song-player {
        width:75px; height:75px;
    }
    #player-logo-background-emerald { background-color:rgba(255,255,255,.15); box-shadow:0 0 8px rgba(255,255,255,.2);}
    #player-logo-background-burgundy { background-color:rgba(255,255,255,.1); box-shadow:0 0 8px rgba(255,255,255,.2); }
    #player-logo-background-ivory { background-color:rgba(0,0,0,.05); box-shadow:0 0 8px rgba(0,0,0,.1); }
    #player-logo-background-secret-song-player { background-color:rgba(255,255,255,.15); box-shadow:0 0 8px rgba(255,255,255,.2); }

   
    .player-controls-emerald button { background:#ecf0f1; border:1px solid #bdc3c7; color:#2c3e50; box-shadow:0 2px 5px rgba(0,0,0,.1); width:42px; height:42px; }
    .player-controls-emerald button:hover:not(:disabled) { background-color:#dde4e6; box-shadow:0 0 10px rgba(46,204,113,.5); }
    .player-controls-emerald button#play-pause-button-emerald.play-pause-btn { width:52px; height:52px; background-color:#2ecc71; color:white; }
    .player-controls-emerald button#play-pause-button-emerald.play-pause-btn:hover:not(:disabled) { background-color:#27ae60; }

    .player-controls-burgundy button { background:#f5e6ea; border:1px solid #d1bec4; color:#600018; box-shadow:0 2px 5px rgba(0,0,0,.1); width:42px; height:42px;}
    .player-controls-burgundy button#play-pause-button-burgundy.play-pause-btn { background-color:#800020; color:white; }

    .player-controls-ivory button { background:#e8e8e0; border:1px solid #dcdcdc; color:#404040; box-shadow:0 2px 5px rgba(0,0,0,.1); width:42px; height:42px;}
    .player-controls-ivory button#play-pause-button-ivory.play-pause-btn { background-color:#808078; color:white; }

    /* Responsive Design */
    @media (max-width:768px){
      body { padding:10px; display:flex; flex-direction:column; align-items:center; }
      main, #intro { order:3; width:100%; margin-top:10px; }
     
      #date-time-logo.widget { position:static; order:-2; margin:0 auto 15px auto; width:90%; max-width:250px; }
      #calculator.widget { position:static; order:-1; margin:0 auto 15px auto; width:90%; max-width:250px; }
      
      .widget.widget-active { animation-delay: 0.2s; /* Adjust delay for mobile if needed */ }


      #intro h1 { font-size:2rem; }
      #intro p { font-size:1rem; }
      #story h2 { font-size:1.5rem; }
      #story-text-content { font-size:1rem; } 

      .music-player-container { 
        flex-direction:column; align-items:center; 
        max-width:90%; margin-top:15px; margin-bottom:15px; 
      }
      .player-logo-wrapper { margin-right:0; margin-bottom:15px; }
      .player-main { width:100%; padding:10px; }
      #scary-text-overlay { font-size: 3rem; }
    }

    @media (max-width: 480px) {
        #calc-display { font-size: 1.3rem; }
        #calc-buttons button { font-size: 0.9rem; padding: 8px; }
        #intro h1, #story h2 { font-size: 1.5rem; } 
        #intro p, #story-text-content { font-size: 0.9rem; }
    }

    /* === Secret Message Styling === */
#secret-message-container {
  position: fixed;
  bottom: 20px; /* Jarak dari bawah layar */
  left: 50%;
  transform: translateX(-50%); /* Untuk memusatkan secara horizontal */
  padding: 8px 15px;
  border-radius: 6px;
  font-family: var(--font-primary); /* Menggunakan font utama seperti cerita */
  font-size: 0.95rem; /* Sedikit lebih kecil agar tidak terlalu dominan */
  color: var(--story-text-color-light); /* Warna default, akan disesuaikan JavaScript untuk dark mode */
  background-color: rgba(0, 0, 0, 0.05); /* Background sangat tipis dan transparan */
  backdrop-filter: blur(2px); /* Efek blur untuk background */
  box-shadow: 0 1px 5px rgba(0,0,0,0.15);
  z-index: 9000; /* Pastikan muncul di atas banyak elemen lain */
  opacity: 0;
  transition: opacity 0.3s ease-in-out; /* Transisi untuk container */
  pointer-events: none; /* Agar tidak bisa diklik atau mengganggu elemen di bawahnya */
  text-align: center;
  max-width: 85%; /* Maksimum lebar container */
  visibility: hidden; /* Awalnya disembunyikan */
}

#secret-message-container.visible {
  opacity: 1;
  visibility: visible;
}

#secret-message-container.hidden {
  opacity: 0;
  visibility: hidden;
}

/* Animasi untuk setiap item pesan */
@keyframes secretMessageFadeInOut {
  0% { opacity: 0; transform: translateY(15px) scale(0.9); } /* Mulai dari bawah, sedikit kecil, transparan */
  15% { opacity: 1; transform: translateY(0) scale(1); }   /* Muncul penuh */
  85% { opacity: 1; transform: translateY(0) scale(1); }   /* Tetap terlihat */
  100% { opacity: 0; transform: translateY(-10px) scale(0.95); }/* Hilang ke atas, transparan */
}

.secret-message-item {
  display: inline-block; /* Agar animasi transform bekerja baik */
  animation: secretMessageFadeInOut 4s cubic-bezier(0.25, 0.1, 0.25, 1) forwards; /* Durasi 2 detik */
}

body.dark-mode #secret-message-container {
  color: var(--story-text-color-dark);
  background-color: rgba(255, 255, 255, 0.05);
  box-shadow: 0 1px 5px rgba(255,255,255,0.1);
}
/* === End Secret Message Styling === */
#local-video-overlay {
  pointer-events: auto; /* Memastikan overlay bisa menerima klik */
}

body.local-video-active {
    overflow: hidden !important;
}
body.local-video-active > *:not(#local-video-overlay):not(#local-video-player) { /* Disesuaikan agar tidak menarget video playernya sendiri jika klik terjadi di dalam */
    pointer-events: none !important;
}

#calendar-toggle-button {
  position: fixed;
  top: 10px;
  /* Atur left berdasarkan lebar tombol dark mode + sedikit spasi */
  left: 65px; /* (Misal: 48px lebar dark mode + 2px border + 15px spasi) */
  z-index: 1001;
  background-color: var(--dm-toggle-bg-light); /* Serupa dengan dark mode toggle */
  border: 2px solid var(--dm-toggle-border-light);
  border-radius: 50%;
  width: 48px;
  height: 48px;
  outline: none;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: background-color 0.5s ease, border-color 0.5s ease, transform 0.3s ease, box-shadow 0.3s ease;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15), 0 0 0px var(--heading-color-light); /* Untuk efek glow */
  overflow: hidden;
  cursor: pointer;
}

#calendar-toggle-button:hover {
  transform: scale(1.1) rotate(-15deg);
  box-shadow: 0 4px 12px rgba(0,0,0,0.2), 0 0 15px var(--heading-color-light); /* Glow lebih kuat saat hover */
}

#calendar-toggle-button .calendar-icon {
  font-size: 24px; /* Sesuaikan jika menggunakan emoji atau font icon */
  /* Styling untuk ikon SVG atau <img> bisa ditambahkan di sini */
  color: var(--dm-toggle-icon-bg-light); /* Atau warna ikon Anda */
  pointer-events: none;
  filter: drop-shadow(0 0 5px var(--dm-toggle-icon-bg-light)); /* Efek glow untuk ikon */
}

/* Styling untuk popup kalender */
#calendar-popup {
  /* top, left, width, dll. sudah diatur inline, bisa disesuaikan lagi */
  /* Gunakan variabel CSS widget yang sudah ada */
  opacity: 0; /* Untuk animasi */
  transform: translateY(-10px) scale(0.95);
  transition: opacity 0.3s ease-out, transform 0.3s ease-out;
}

#calendar-popup.visible {
  opacity: 1;
  transform: translateY(0) scale(1);
}

#calendar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
  width: 100%;
}
#calendar-header button {
  background: var(--calc-btn-bg-light);
  color: var(--widget-text-light);
  border: none;
  padding: 5px 10px;
  border-radius: 3px;
  cursor: pointer;
}
#calendar-header button:hover {
  background: var(--calc-btn-hover-bg-light);
}
#calendar-month-year {
  font-weight: bold;
  font-size: 1.1em;
}

#calendar-days {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 5px;
  width: 100%;
}
#calendar-days div {
  padding: 8px 5px;
  text-align: center;
  border-radius: 3px;
  cursor: pointer;
  background-color: var(--calc-btn-bg-light);
  transition: background-color 0.2s ease, transform 0.1s ease;
}
#calendar-days div:hover:not(.empty):not(.weekday-header) {
  background-color: var(--calc-btn-hover-bg-light);
  transform: scale(1.05);
}
#calendar-days div.empty {
  background-color: transparent;
  cursor: default;
}
#calendar-days div.weekday-header {
  font-weight: bold;
  background-color: transparent;
  cursor: default;
  font-size: 0.8em;
  padding-bottom: 2px;
  border-bottom: 1px solid rgba(255,255,255,0.2);
}
#calendar-days div.today {
  background-color: var(--heading-color-light);
  color: white;
  font-weight: bold;
}
#calendar-days div.selected {
  background-color: var(--button-hover-bg-light);
  color: var(--button-text-light);
  box-shadow: 0 0 5px var(--button-hover-bg-light);
}


/* Penyesuaian untuk Dark Mode (jika diperlukan, banyak yang sudah ter-handle variabel) */
body.dark-mode #calendar-toggle-button {
  background-color: var(--dm-toggle-bg-dark);
  border-color: var(--dm-toggle-border-dark);
  box-shadow: 0 2px 8px rgba(255,255,255,0.1), 0 0 0px var(--heading-color-dark);
}
body.dark-mode #calendar-toggle-button:hover {
  box-shadow: 0 4px 12px rgba(255,255,255,0.15), 0 0 15px var(--heading-color-dark);
}
body.dark-mode #calendar-toggle-button .calendar-icon {
  color: var(--dm-toggle-border-dark);
  filter: drop-shadow(0 0 5px var(--dm-toggle-border-dark));
}
body.dark-mode #calendar-header button {
  background: var(--calc-btn-bg-dark);
  color: var(--widget-text-dark);
}
body.dark-mode #calendar-header button:hover {
  background: var(--calc-btn-hover-bg-dark);
}
body.dark-mode #calendar-days div {
  background-color: var(--calc-btn-bg-dark);
}
body.dark-mode #calendar-days div:hover:not(.empty):not(.weekday-header) {
  background-color: var(--calc-btn-hover-bg-dark);
}
body.dark-mode #calendar-days div.today {
  background-color: var(--heading-color-dark);
}
body.dark-mode #calendar-days div.selected {
  background-color: var(--button-hover-bg-dark);
  color: var(--button-text-dark);
  box-shadow: 0 0 5px var(--button-hover-bg-dark);
}
body.dark-mode #calendar-days div.weekday-header {
  border-bottom: 1px solid rgba(255,255,255,0.1);
}
/* Penyesuaian untuk Mobile */
@media (max-width: 768px) {
  /* Remove individual mobile positioning for dark-mode-toggle */
  #top-controls-wrapper {
    order: -3; /* Posisikan grup tombol ini paling atas */
    display: flex;
    justify-content: center; /* Pusatkan tombol-tombol di dalam wrapper */
    align-items: center;
    gap: 15px; /* Jarak antar tombol */
    width: auto; /* Lebar wrapper mengikuti kontennya */
    margin-bottom: 15px; /* Jarak bawah dari grup tombol ke elemen berikutnya */
  }

  /* Pastikan tombol di dalam wrapper tidak lagi punya margin auto individual */
  #dark-mode-toggle, #calendar-toggle-button {
    position: relative; /* Atau biarkan static jika tidak perlu layering khusus */
    order: unset; /* Hapus order individual jika sudah di dalam wrapper */
    margin: 0; /* Hapus margin auto individual */
  }
  /* AKHIR STYLING BARU UNTUK WRAPPER */
  
  /* Ensure other widgets are correctly ordered below */
  #date-time-logo.widget { position:static; order:-2; margin:0 auto 15px auto; width:90%; max-width:250px; }
  #calculator.widget { position:static; order:-1; margin:0 auto 15px auto; width:90%; max-width:250px; }
  .widget.widget-active { animation-delay: 0.2s; /* Adjust delay for mobile if needed */ }

  

 
}





  </style>
</head>
<body>
  <div id="top-controls-wrapper">
    <button id="dark-mode-toggle" title="Toggle Dark Mode" aria-label="Toggle Dark Mode">
      <span class="toggle-icon"></span>
    </button>

    <button id="calendar-toggle-button" title="Buka Kalender" aria-label="Buka Kalender">
      <span class="calendar-icon">üóìÔ∏è</span>
    </button>
  </div>

  

   <!-- DIV UNTUK POPUP KALENDER (AWALNYA DISEMBUNYIKAN) -->
   <div id="calendar-popup" class="widget" style="display: none; top: 60px; left: 10px; width: auto; min-width: 280px; z-index: 1002; flex-direction: column; align-items: center; padding: 15px;">
    <div id="calendar-header">
      <button id="calendar-prev-month"><</button>
      <span id="calendar-month-year"></span>
      <button id="calendar-next-month">></button>
    </div>
    <div id="calendar-days"></div>
    <p id="calendar-message-display" style="margin-top: 10px; color: var(--widget-text-light); font-size: 0.9em; min-height: 1.2em; text-align: center;"></p>
  </div>

  <div id="date-time-logo" class="widget" title="Date and Time">
    <!-- Content populated by JS -->
    <div id="countdown">Initializing countdown...</div>
  </div>

  <div id="calculator" class="widget" title="Calculator">
    <div id="calc-display">0</div>
    <div id="calc-buttons">
      <button>7</button><button>8</button><button>9</button><button>/</button>
      <button>4</button><button>5</button><button>6</button><button>*</button>
      <button>1</button><button>2</button><button>3</button><button>-</button>
      <button>0</button><button>.</button><button>=</button><button>+</button>
      <button id="clear">C</button>
    </div>
  </div>
  
  <div id="fire-background"></div>
  <div id="scary-text-overlay">..--- .---- ..... .---- -----</div>
  
  <section id="intro">
    <h1>Salve. Mihi nomen est Aether.</h1>
    <p id="intro-paragraph">
      Non nomen verum, sed hoc nomen satis est ut ostendam quis vere sim in mundo invisibili.<br><br>
      Non crevi in domo plena velocitate interretiali aut ornamentis pulchris.<br>
      Crescebam inter funes electricos disruptos, auriculares fractos, et horologium cybercafei quod cordi meo timorem incutiebat.<br><br>
      Per diem ephemerides vendebam ut panem familiae pararem. Nocte in taberna interretiali manebam, studens codici, ludis electronicis, et quaestionibus quae iustitiam tangunt.<br><br>
      Non semel in solo dormivi, velut statua muta, dum codicem scribebam.<br><br>
      Sed ibi didici multa:<br>
      Quomodo cogitatio simplex systema magnum movere possit.<br>
      Quomodo puer ignotus potest fieri vox contra iniustitiam.<br>
      Et quomodo matri explicari debeat quod programmare non est peccatum.<br><br>
      Hodie ego non sum vir clarus. Sed fabula quam fero fortasse tua quoque est.<br>
      In strepitu claviaturae antiqui computatri, invenitur vox eorum qui saepe neglecti sunt.
    </p>
    <button id="start-story">Lanjutkan</button>
  </section>

  <main>
    <section id="story">
      <a id="aetherx-link" href="https://forms.gle/VzLHyZP4JiybKRar5" target="_blank" rel="noopener noreferrer">
      
        <img id="aetherx-logo" src="aethery.png" alt="Logo AetherZ">
      </a>
      <h2>Ego, Puer Interneti, et Cicatrices Manentes</h2>
      <p id="story-text-content">
        <br>¬¶‚Ç¨√¢euqsu</br>
        <br>"tse autrom aem mailif" mutcid illi</br>
        <br>¬¶‚Ç¨√¢mumitlu mitanmad euqsu</br>
        <br>"tse autrom aem mailif" ivacov suem retap</br>
        <br>metrap tse matlupes manu</br>
        <br>tse autrom ila te</br>
        <br>ut te</br>
        <br>autrom maite‚Äù‚Ç¨√¢ainmo ibit te</br>
        <br>et te</br>
        <br>alli te</br>
        <br>edroc ni sibicud sitluts a</br>
        <br>tenretni a</br>
        <br>aem alohcs a</br>
        <br>alohcs anrecul tnus mauqmun</br>
        <br>terepmurretni metnerap iuq irue mubmun patem tu des</br>
        <br>matep maidrociresim tu non obircs coh</br>
        <br>rutidua satirev sutad</br>
        <br>sanitatem tertni eauq taps ativ ed des‚Äù‚Ç¨√¢irileurep eroma erede non</br>
        <br>non alohcs onedo</br>
        <br>tnus sutnauq mauqmun senoissim mauqila</br>
        <br>cnun</br>
        <br>muus eropmet asnem ni sarep sunis manips atcer sitnegilletni muem retarf</br>
        <br>oebah iem retam malos</br>
        <br>tebed erenitsus iuq</br>
        <br>mus oge</br>
        <br>merof emaf mudretni miretni</br>
        <br>easocoi ealubaf suem rolod isauq‚Äù‚Ç¨√¢susserppo susulcxe suiredised</br>
        <br>mus lihin</br>
        <br>alohcs ni te</br>
        <br>manosrep nemon sutreporp</br>
        <br>sutsuni mat</br>
        <br>tedis meidbus muroloc ihim eauq malleup</br>
        <br>alohcs menoitadilav da cavarp ie ivarap sunu snum</br>
        <br>tipeoc gniyllubrebyc ba em mabednefed</br>
        <br>igel suie satpircs</br>
        <br>mus lihin</br>
        <br>alohcs ni te</br>
        <br>manosrep sunu sutreporp</br>
        <br>atcarf tse aem ativ</br>
        <br>tse arebrev tes tabarever tiledurc anu tare retam</br>
        <br>retam</br>
        <br>tare aem retam‚Äù‚Ç¨√¢atcarf tse aem ativ</br>
        <br>¬¶‚Ç¨√¢aem retam te</br>
        <br>muigufer tse repmes non sumod</br>
        <br>ivics otnemom olli xe</br>
        <br>angup amissitnelis tset sumus mudnaliuqa</br>
        <br>cnun</br>
        <br>muus eropmet asnem ni sarep sunis manips atcer sitnegilletni muem retarf</br>
        <br>oebah iem retam malos</br>
        <br>tebed erenitsus iuq</br>
        <br>mus oge</br>
        <br>merof emaf eidemretni mudretni</br>
        <br>easocoi ealubaf suem rolod isauq‚Äù‚Ç¨√¢susserppo susulcxe suorised</br>
        <br>mus lihin</br>
        <br>alohcs ni tse</br>
        <br>meid esse maipulsorp mulos non</br>
        <br>maem aiv epoc ipeoc ibi</br>
        <br>mabamalac et siromalc banimun mud</br>
        <br>essecca eaem sirclupes messe muc des</br>
        <br>iutop erepicsus medif suilpma illun</br>
        <br>eid olli xe</br>
        <br>tenam oem edroc ni amuart</br>
        <br>oebah nemin</br>
        <br>maem marteper</br>
        <br>aitnatsni tse ihim</br>
        <br>tnus enoisivelet ni eauq auqitna aiuqolloc et eaigiler mairomem etrep</br>
        <br>tnus itnatser ihim</br>
        <br>tnus cnih inmo tnus</br>
        <br>nonohpelet otsutev auqitna aiuqol mauqitna te meromem macuder tu des</br>
        <br>maitucreper tu non‚Äù‚Ç¨√¢ixerrus</br>
        <br>tnus easualc saresu senmo muc</br>
        <br>oitnelis olli ni te</br>
        <br>tse enif enif tse sinoitcon aidem</br>
        <br>mutrepa mauqmun odnum ni isauq</br>
        <br>tare muem roc</br>
        <br>tnuredicec maem mamina maupesrep</br>
        <br>tidicec mamirepus maem emissid mareeneb</br>
        <br>tse autrom alli mauqtsop ropmet</br>
        <br>tivatum et</br>
        <br>tidicec maem mamirepus emissisned sarbenet</br>
        <br>tse autrom aill mauq tsop ropmet</br>
        <br>tuitop esse made mureti mauqmun</br>
        <br>atcarf tsemel maem mativ</br>
        <br>tse atcarf aem ativ</br>
        <br>mus meledif esse</br>
        <br>iutop non</br>
        <br>aititsui ni odnum ni</br>
        <br>senimoh ni aem sedif</br>
        <br>meid esse maipulsorp mulos non</br>
        <br>erereauq maem maiv ipeoc ibi</br>
        <br>mabamalc sutsni des tnadiber snenimoh</br>
        <br>tnus atcarf ainmo‚Äù‚Ç¨√¢aititsui ni odnum ni senimoh ni</br>
        <br>ledif esse sumid esse medi siulpma iutop non</br>
        <br>teralever maem mamimac et maem mativ eauq</br>
        <br>teregeted siratilim salam sanosrep et teralever metatirev des tiurappa airolg orp non</br>
        <br>iitnelis iaugnil rutabeuqol murcaro enimalusni odnum ilaer ni</br>
        <br>titsixe xiv sitnegilletni muem rolod tse siuq oicsen</br>
        <br>eranos ihim sutogni iuq suio siuqse</br>
        <br>tnediv dicuap mauq tatlucco etrap ni tseretni sirbmu ni</br>
        <br>tivatam eauqiler satirev tamun tu tidnecsed odnuforp ni rotacipsus isauq</br>
        <br>itcartxe lucem mecul da ainmo</br>
        <br>erede saslaf senoitater te</br>
        <br>erarepucer sateled salubat sosonenev soiratnemmoc ni tiutop</br>
        <br>mus sutuces igel suie eatpircs</br>
        <br>mue sius metrom tsop iamet</br>
        <br>eter ni eratlusni cuhda atuca acima nemon erediv tesse diuq tecirts sudnum ut iulov</br>
        <br>isnes oge meuq merolod tiritnes ut iulov</br>
        <br>tidotsuc muluvlup retarf mud tatlucsua aogretam metcon iuq reep ut ni euq</br>
        <br>mitciv ut ereviv tesse diuq tercs sumdun tu isulov</br>
       </p>
      <button id="next-button">Lanjutkan</button>

      
      
      <!-- Music Players -->
      <div id="music-player-container-fuchsia" class="music-player-container">
        <div id="player-logo-wrapper-fuchsia" class="player-logo-wrapper">
          <div id="player-logo-background-fuchsia" class="player-logo-background"></div>
          
          <img src="aethery.png" alt="AetherZ Logo" id="player-aetherx-logo-fuchsia" class="player-aetherx-logo">
        </div>
        <div class="player-main player-main-fuchsia">
          <div class="track-info track-info-fuchsia">
            <span id="track-title-fuchsia">Memuat...</span><span id="track-artist-fuchsia"></span>
          </div>
          <input type="range" id="seek-bar-fuchsia" class="player-seek-bar" value="0" step="1" aria-label="Seek bar for Fuchsia player">
          <div class="time-display time-display-fuchsia">
            <span id="current-time-fuchsia">0:00</span> / <span id="total-duration-fuchsia">0:00</span>
          </div>
          <div class="player-controls player-controls-fuchsia">
            <button id="prev-button-fuchsia" title="Previous Player" aria-label="Previous Player">¬´</button>
            <button id="play-pause-button-fuchsia" class="play-pause-btn" title="Play" aria-label="Play or Pause Fuchsia player">‚ñ∫</button>
            <button id="next-button-fuchsia" title="Next Player" aria-label="Next Player">¬ª</button>
          </div>
        </div>
        <audio id="audio-player-fuchsia" preload="metadata"></audio>
      </div>

      <div id="music-player-container-emerald" class="music-player-container">
        <div id="player-logo-wrapper-emerald" class="player-logo-wrapper">
          <div id="player-logo-background-emerald" class="player-logo-background"></div>
         
          <img src="aethery.png" alt="AetherZ Logo" id="player-aetherx-logo-emerald" class="player-aetherx-logo">
        </div>
        <div class="player-main player-main-emerald">
          <div class="track-info track-info-emerald">
            <span id="track-title-emerald"></span><span id="track-artist-emerald"></span>
          </div>
          <input type="range" id="seek-bar-emerald" class="player-seek-bar" value="0" step="1" aria-label="Seek bar for Emerald player">
          <div class="time-display time-display-emerald">
            <span id="current-time-emerald">0:00</span> / <span id="total-duration-emerald">0:00</span>
          </div>
          <div class="player-controls player-controls-emerald">
            <button id="prev-button-emerald" title="Previous Player" aria-label="Previous Player">¬´</button>
            <button id="play-pause-button-emerald" class="play-pause-btn" title="Play" aria-label="Play or Pause Emerald player">‚ñ∫</button>
            <button id="next-button-emerald" title="Next Player" aria-label="Next Player">¬ª</button>
          </div>
        </div>
        <audio id="audio-player-emerald" preload="metadata"></audio>
      </div>

      <div id="music-player-container-burgundy" class="music-player-container">
        <div id="player-logo-wrapper-burgundy" class="player-logo-wrapper">
          <div id="player-logo-background-burgundy" class="player-logo-background"></div>
          
          <img src="aethery.png" alt="AetherZ Logo" id="player-aetherx-logo-burgundy" class="player-aetherx-logo">
        </div>
        <div class="player-main player-main-burgundy">
          <div class="track-info track-info-burgundy">
            <span id="track-title-burgundy"></span><span id="track-artist-burgundy"></span>
          </div>
          <input type="range" id="seek-bar-burgundy" class="player-seek-bar" value="0" step="1" aria-label="Seek bar for Burgundy player">
          <div class="time-display time-display-burgundy">
            <span id="current-time-burgundy">0:00</span> / <span id="total-duration-burgundy">0:00</span>
          </div>
          <div class="player-controls player-controls-burgundy">
            <button id="prev-button-burgundy" title="Previous Player" aria-label="Previous Player">¬´</button>
            <button id="play-pause-button-burgundy" class="play-pause-btn" title="Play" aria-label="Play or Pause Burgundy player">‚ñ∫</button>
            <button id="next-button-burgundy" title="Next Player" aria-label="Next Player">¬ª</button>
          </div>
        </div>
        <audio id="audio-player-burgundy" preload="metadata"></audio>
      </div>

      <div id="music-player-container-ivory" class="music-player-container">
        <div id="player-logo-wrapper-ivory" class="player-logo-wrapper">
          <div id="player-logo-background-ivory" class="player-logo-background"></div>
         
          <img src="aethery.png" alt="AetherZ Logo" id="player-aetherx-logo-ivory" class="player-aetherx-logo">
        </div>
        <div class="player-main player-main-ivory">
          <div class="track-info track-info-ivory">
            <span id="track-title-ivory"></span><span id="track-artist-ivory"></span>
          </div>
          <input type="range" id="seek-bar-ivory" class="player-seek-bar" value="0" step="1" aria-label="Seek bar for Ivory player">
          <div class="time-display time-display-ivory">
            <span id="current-time-ivory">0:00</span> / <span id="total-duration-ivory">0:00</span>
          </div>
          <div class="player-controls player-controls-ivory">
            <button id="prev-button-ivory" title="Previous Player" aria-label="Previous Player">¬´</button>
            <button id="play-pause-button-ivory" class="play-pause-btn" title="Play" aria-label="Play or Pause Ivory player">‚ñ∫</button>
            <button id="next-button-ivory" title="Next Player" aria-label="Next Player">¬ª</button>
          </div>
        </div>
        <audio id="audio-player-ivory" preload="metadata"></audio>
      </div>

      <div id="music-player-container-secret-song-player" class="music-player-container">
        <div id="player-logo-wrapper-secret-song-player" class="player-logo-wrapper">
          <div id="player-logo-background-secret-song-player" class="player-logo-background"></div>
         
          <img src="aethery.png" alt="AetherZ Logo" id="player-aetherx-logo-secret-song-player" class="player-aetherx-logo">
        </div>
        <div class="player-main player-main-secret-song-player">
          <div class="track-info track-info-secret-song-player">
            <span id="track-title-secret-song-player"></span><span id="track-artist-secret-song-player"></span>
          </div>
          <input type="range" id="seek-bar-secret-song-player" class="player-seek-bar" value="0" step="1" aria-label="Seek bar for Secret Song player">
          <div class="time-display time-display-secret-song-player">
            <span id="current-time-secret-song-player">0:00</span> / <span id="total-duration-secret-song-player">0:00</span>
          </div>
          <div class="player-controls player-controls-secret-song-player">
            <button id="prev-button-secret-song-player" title="Previous" style="display:none;" aria-label="Previous Song (hidden)">¬´</button>
            <button id="play-pause-button-secret-song-player" class="play-pause-btn" title="Play" aria-label="Play or Pause Secret Song player">‚ñ∫</button>
            <button id="next-button-secret-song-player" title="Close Player" aria-label="Close Secret Song player">‚úï</button>
          </div>
        </div>
        <audio id="audio-player-secret-song-player" preload="metadata"></audio>
      </div>
    </section>

    <section id="next-page"> 
      <div id="link-container">
      </div>
    </section>
  </main>

  <div id="youtube-video-overlay" aria-hidden="true">
    <div id="youtube-player-container">
      <!-- YouTube IFrame will be injected here by JS -->
    </div>
  </div>

  <!-- Tambahkan ini di dalam <body> -->
<div id="local-video-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: rgba(0,0,0,0.9); z-index: 35000; /* Di atas youtube overlay */ justify-content: center; align-items: center;">
  <video id="local-video-player" width="80%" height="80%" controls style="max-width: 100%; max-height: 100%;"></video>
</div>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.4.2/chroma.min.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DOM Element Cache ---
        const Cache = {
            body: document.body,
            introSection: document.getElementById('intro'),
            mainContent: document.querySelector('main'),
            startStoryButton: document.getElementById('start-story'),
            nextButtonMainPage: document.getElementById('next-button'),
            scaryTextOverlay: document.getElementById('scary-text-overlay'),
            fireBackground: document.getElementById('fire-background'),
            calcDisplay: document.getElementById('calc-display'),
            calcButtonsContainer: document.getElementById('calc-buttons'),
            dateTimeLogo: document.getElementById('date-time-logo'),
            countdownElement: document.getElementById('countdown'),
            calculatorWidget: document.getElementById('calculator'),
            dateTimeWidget: document.getElementById('date-time-logo'), 
            youtubeVideoOverlay: document.getElementById('youtube-video-overlay'),
            youtubePlayerContainer: document.getElementById('youtube-player-container'),
            darkModeToggleButton: document.getElementById('dark-mode-toggle'),
            storyTextParagraph: document.getElementById('story-text-content'),
            aetherxLogoInStory: document.querySelector('#story #aetherx-logo'),
            localVideoOverlay: document.getElementById('local-video-overlay'),
            localVideoPlayerElement: document.getElementById('local-video-player'),
            calendarToggleButton: document.getElementById('calendar-toggle-button'),
            calendarPopup: document.getElementById('calendar-popup'),
            calendarHeaderPrevBtn: document.getElementById('calendar-prev-month'),
            calendarHeaderNextBtn: document.getElementById('calendar-next-month'),
            calendarMonthYearText: document.getElementById('calendar-month-year'),
            calendarDaysContainer: document.getElementById('calendar-days'),
            calendarMessageDisplay: document.getElementById('calendar-message-display'),
        };

        // --- State Variables ---
        let State = {
            youtubePlayer: null,
            originalStoryTextHTML: Cache.storyTextParagraph ? Cache.storyTextParagraph.innerHTML : '',
            currentPlayerIndex: 0,
            activePlayerElements: {},
            activePlayerConfig: {},
            activePlayerType: 'main', 
            currentCalcInput: '',
            previousCalcInput: '',
            calcOperator: null,
            calcInputSequence: [],
            calcInputSequence666: [],
            calcInputSequence777: [], // Added for 777 trigger
            calcMultiplyClicks: 0,
            calcDivideClicks: 0,
            dateTimeLogoClickCount: 0,
            countdownTime: 9504000, 
            isDarkMode: false,
            nextButtonTimerId: null,
            isScaryEffectActive: false, // To manage state of the scary date/time effect
            calcInputSequence328: [],      // Untuk melacak urutan angka 328
            is328TriggerEnabled: true,     // Untuk mengontrol apakah pemicu 328 aktif
            calcInputSequence8427: [],
            currentCalendarDate: new Date(), // Tanggal yang ditampilkan kalender
            isCalendarVisible: false,
            calendarMessageTimeoutId: null,
            calcInputSequence115: [],
            calcInputSequence2022: [],
        };
        
        // --- Constants & Configuration ---
        const MORSE_MESSAGE_FOR_STORY = "LSAuIC0uLiAtLiAtLS0gLi0tLiAuLi4gLiAuLS4gLyAtLSAuLSAuLi0gLS0uLSAtLSAuLi0gLS4gLyAtLi4gLS0tIC4uLSAtLS4tIC8gLS0gLi4tIC4tLi4gLiAuLSAtLi0uIC8gLi4uIC4gLSAtLiAuLSAtIC0uLS4gLiAuLS0uIC4uLiAvIC0tLi4tLSAtLS0gLS4uIC0uIC4tIC0tIC4uIC4tLiAtLi0uIC4tIC4tLi4gLyAuLiAuLi4gLi4uIC4gLi4tLiAvIC4uLiAuLiAtLSAuLiAtLiAvIC4uIC4tLi4gLi4tIC0uLS4gLS0tIC8gLSAtLiAuLi0gLi4uIC8gLS0uLi0tIC0tLSAtLi4gLS4gLi0gLi4tIC0tLi0gLi4gLi0uLiAuLSAvIC4tLi0uLSAuIC4tIC4tLi4gLi0uLiAuIC0gLi4uIC8gLSAtLiAuLi0gLi4uIC8gLSAtLiAuIC0uLS4gLi4tIC4tLi4gLyAuIC4tIC4uLSAtLS4tIC8gLi0gLi4gLS4gLS0gLS0tIC8gLS4gLS0tIC0uIC8gLi0uLS4tIC0tLSAtLi4uIC4uIC4tLiAtLi0uIC4uLiAuIC4tLiAvIC4uLiAuLiAtLSAuLiAuLS4gLS4tLiAuLSAuLS4uIC8gLS4tLiAtLiAuLi0gLS4gLyAtLS4uLS0gLi4gLi4uLSAuIC4tLi4gLi0tLiAtLSAuLiAvIC0tLSAuLiAtLi4gLS0tIC8gLS0gLi4tIC0uLS4gLyAtLSAuLiAuLS4uIC0tLSAvIC4uLiAuLSAuLi0gLS0uLSAvIC4uLiAuIC0uLS4gLiAuLS4gLi0tLiAvIC0tLi4tLSAtIC4tIC4uIC0uLS4gLi4uIC8gLi0gLi0uLiAuLS4uIC4uIC8gLSAuLi0gLyAtLS0uLi4gLS0tIC4uIC4tLS4gLi4tIC0uLS4gLyAtLSAuIC4tLiAvIC0tIC4tIC0uIC4uLSAvIC0tLi4tLSAtLS0gLiAuLi4gLS4gLi0gLi0uIC0gLyAtLSAuLiAtIC4tIC0uLiAuLSAuLS4gLS0uIC8gLS4uIC0tLSAuLi0gLS0uLSAvIC4gLi0uIC0tLSAuLS0uIC0tIC4gLSAvIC0tLSAuLi0gLS0uLSAuLiAuLS4uIC4gLi0uIC8gLS4gLi4gLyAtIC4gLyAuLiAuLi0gLi4tLiAvIC4uLiAuLi0gLSAtLi0uIC4tIC4tLiAuLi0uIC8gLiAtLi4gLi0uLiAuLSAuLi0tIC8gLi0gLi4gLi4tIC0tLi0gLyAtLi4gLiAuLi4gLi4gLi4tIC4uLS4gLyAuLi4gLi4tIC4tLi4gLi0gLS0gLyAuLSAuLiAuLi0gLS0uLSAvIC0uIC0tLSAtLiAvIC0tLi4tLSAtLS0gLSAtLiAuIC0tIC4gLS0gLyAtLS4uLS0gLi4uIC4uIC4tLiAuIC4uIC0uLiAuLi0gLi0gLyAtLSAuLi0gLiAtLSAvIC0uIC4gLS0gLS0tIC0uIC8gLS0tIC0uLiAtLiAuLSAuLi0gLS0uLSAuLiAuLS4uIC4tIC8gLi4gLi4uIC8gLS4uIC4gLi4uIC8gLS0uLi0tIC0gLi4gLS4uLiAuLSAtLi4gLyAtLiAtLS0gLS4gLyAtLSAuIC0uIC0tLSAuLiAuLi4gLi0gLS4tLiAtLi0uIC0tLSAvIC0tIC4tIC0uLiAtLiAuLi0gLS4tLiAuIC4uLiAvIC4uIC4uLiAgLi4gLS0gLyAuLSAtIC4uIC4uLi0gLyAuIC4uLiAuLi4gLi0gLSAuLS4gLS0tIC4uLS4gLyAtIC4uIC0uLS4gLiAuLi0uIC4gLS4uIC8gLS4uIC4gLi4uIC8gLS0uLi0tIC4gLSAtLi0uIC4gLi0uIC8gLSAuLiAuLi0gLi0uLiAtLS0gLi4uLSAvIC4gLi0uIC4tIC0tIC4tIC8gLS0tIC0uLiAtLiAuLSAuLi0gLS0uLSAuLiAuLS4uIC4tIC8gLi4gLi4tIC0tLi0gLyAuLi4gLi4gLyAtIC4uLSAvIC0tLSAuLS4uIC0tLSAuLi4tIC8gLi4gLi0uIC4tIC4tLiAtLS0gLS0gLiAtLSAvIC0tIC4uLSAtIC0uIC4tIC0gLyAuLS4tLi0gLS0tIC4tLi4gLS0tIC0uIC8gLi4gLSAtIC4uIC0tIC4gLi0uIC8gLiAuLi4gLi4uIC4uIC0uLiAtLS0gLi4tLiAvIC4uLiAuLi0gLi4gLiAvIC0tIC4uLSAuLS4gLS4tLiAuLS4uIC4uLSAuLS0uIC4gLi4uIC8gLS0gLi4tIC4uLiAuLS0uIC4uIC8gLiAtLSAvIC0gLiAvIC4tLi0uLSAuLS4tLi0gLi0uLS4tIC4gLi4uIC4uLiAuLiAuLi0gLi4tLiAvIC0tIC4uLSAtIC4tIC0tIC4tIC8gLS0tIC0uLiAtLiAuLSAuLi0gLS0uLSAuLiAuLS4uIC4tIC8gLiAtLSAvIC0tIC4uIC4tLiAuIC0uIC4uIC0tIC4gLS0gLyAtIC4uLSAvIC0tLi4tLSAtIC4gLi4uIC4uLiAuLiAuLi0gLS0uLSAuLiAuLS4uIC4gLi0uIC8gLS0tIC4gLS0gLyAuIC4tLiAtLS0gLi0tLiAtLS0gLi4uIC8gLS4gLi4gLyAuLi4gLi4tIC4uIC4gLyAuLi4gLi4tIC0gLi0uLiAuLi0gLi4uLSAvIC4tIC0gLS4gLiAtLSAtLS4gLi0gLi0uIC4uLS4gLyAuIC4uLiAuLS0uIC4uIC8gLi4uIC4uLSAuIC0uLiAvIC4uIC4uLiAuLSAuLi0gLS0uLSAvIC0tLi4tLSAuLiAuLi4tIC4uIC4uLiAuIC4tIC4uLSAtLS4tIC8gLi4uIC4uIC4uIC0uIC0tIC0tLSAuLi4gLyAtLiAuLiAvIC4uLiAuLi0gLi4gLiAvIC0tIC4tIC4tLiAtLi4uIC0tIC4uLSAvIC0tLi4tLSAtLS0gLi4uLSAuLiAuLSAuLS4gLi0tIC4tIC8gLS4gLi4gLyAtLSAuLi0gLi4uIC8gLi4uIC4uLSAtIC4tIC0uIC0tLSAtLi0uIC8gLiAuLS4gLi0gLS0gLi0gLi0uLiAtLi0uIC8gLS0gLi4tIC4uLiAuLi4gLS0tIC4tLS4gLyAtLiAtLS0gLS4gLyAuLiAtIC0uLS4gLiAuLS4uIC4tLS4gLS0gLi0gLyAuLi4gLi0gLi4tIC0tLi0gLyAtIC4tIC4uLi0gLi0uIC4gLi4uIC8gLi4uIC4tIC0tIC4uIC4tLiAtLi0uIC4tIC4tLi4gLyAuLiAuLi0gLS0uLSAvIC4uLiAuIC4uIC0uLiAvIC4tLi0uLSAuLS0gLi4gLS4uIC0tLSAvIC0tIC4gLi4tIC0tLi0gLyAuLi4gLiAuLiAtLi4gLyAtIC4uLiAuIC8gLS4tLiAtLiAuLi0gLS4gLyAtLS4uLS0gLSAuLSAtLi4uIC4tIC0gLi4uIC4uIC0uLiAvIC4gLS0gLyAuLSAvIC4gLi4gLS4uIC8gLS0tIC0uIC4uLSAvIC4tIC4uIC4uLSAtLS4tIC8gLS0uLi0tIC0tIC4tIC0uLi4gLi0gLi0uLiAuLS4uIC4gLi0tLiAuLS0uIC4tIC8gLi0uLi0uIC0tIC4gLi0uIC4tIC4tLi4gLi4tIC0tLiAtLiAuLiAuLi4gLi0uLi0uIC8gLi0uIC4gLi0tLiAtLSAuIC4uLiAvIC0tIC4gLi4tIC0tLi0gLyAtLS4uLS0gLi4uIC4uLSAuLiAuIC8gLi4uIC4uIC4tLi4gLi0gLSAuLSAtLiAvIC4uLiAuIC4uIC0uLiAvIC4tLi0uLSAuLiAtLi4tIC4uLSAuLS4gLSAuLi4gLiAtLi4gLyAtLSAuLi0gLiAvIC0tIC4tIC4uLSAtLS4tIC0gLi4uIC0tLSAuLS0uIC8gLi4uIC4uIC4uLi0gLi0gLi0uIC0tLiAvIC4uLiAuLiAtLSAuLiAtLiAvIC0gLi4uIC4gLyAuLi4gLi4tIC0gLS4tLiAuLSAuLi0uIC8gLi4uIC4uLSAtLi4gLS4gLi4tIC0tIC8gLS4uIC0tLSAuLi0gLS0uLSAvIC0uLiAuIC4uLiAvIC0tLi4tLSAuIC4tLiAtLS0gLi0tLiAtLSAuIC0gLyAtLiAtLS0gLS4gLSAuLiAuLiAtLi4uIC4tIC8gLi0gLi0uLiAuLS4uIC4uIC8gLi4gLi4uLSAuLSAuIC4tLiAtLi0uIC8gLiAuLi4gLi0tLiAuLiAvIC4uLiAuLSAuLi0gLS0uLSAvIC0gLi4gLS4uIC4uIC0uLS4gLiAtLi0uIC8gLi4uIC4tIC4tLiAtLi4uIC4gLS4gLiAtIC8gLS4gLi4gLyAuIC0tIC8gLS0gLi4tIC0uLS4gLyAuLSAtLiAuLi0gLyAtLS4uLS0gLSAuLiAuLi0gLi4tLiAvIC4tIC0tIC4uIC4uLiAuLi4gLi4gLi0uIC4gLS4tLiAtLiAuLiAuLi4gLyAuIC4tIC4uLSAtLS4tIC8gLS0uLi0tIC4tIC4tLi4gLi0uLiAuLiAvIC0uLS4gLiAtLiAtLS0gLS4uIC8gLS0uLi0tIC4gLi0uIC4tIC4uLSAtLS4tIC4gLi0gLyAuLSAuLiAtLiAtLSAtLS0gLyAtLSAuIC0uIC0tLSAuLiAtIC4tLi4gLi4tIC8gLi4gLi4uLSAuLSAtIC4uLSAuLS0uIC8gLi0uLS4tIC0gLS4gLi4tIC4uLiAvIC4gLi0gLS4uLSAuIC4tLi4gLi0tLiAtLSAuLSAvIC0tIC4uLSAuLiAtLi4gLS0tIC8gLiAuLSAuIC0tIC8gLi4uIC4uLSAtLiAuLSAtLSAvIC0uLiAuIC4uLiAvIC0tLi4tLSAuLiAuLi0gLi0uLiAtLS0gLi4uLSAvIC4gLi4uIC4uLiAuIC8gLi4uIC0tLSAuLS4gLiAuLi4uIC8gLi0uLS4tIC4gLi0gLiAtLSAvIC4uLiAuIC0uLS4gLiAuLS4gLi0tLiAvIC0tIC4tIC4uLSAtLS4tIC8gLSAuLSAuLS4gLiAvIC4tLiAtLS0gLi4gLi0uIC4gLi0uLiAuIC0uLS4gLyAuLSAuIC0tIC8gLi0gLi4gLSAuLiAtIC4tLi4gLi4tIC0gLi4uIC8gLS4uIC4gLi4uIC8gLi0uIC4gLi0tLiAuLi4gLi4gLi0uLiAuLi0gLi0gLi0tLiAvIC4uIC4uLiAvIC0tIC4tIC4uIC0gLiAvIC0tLi4tLSAuIC4tLiAuIC0uLiAuLiAuLS4gLiAtLi4gLyAuIC0tIC8gLiAuLS4gLi0gLi4uIC4uLiAuIC0uLS4gLyAuLiAuLi4gLi0gLi4tIC0tLi0gLyAtLSAuLi0gLS4uIC0uIC4uLSAtLSAvIC0gLi4gLS4tLiAuIC4uLS4gLyAtLi4tIC0tLSAuLi4tIC8gLi4uIC4uLSAuLiAuLi0gLS4tLiAvIC0tLi4tLSAtLS0gLSAuLi4gLiAuLi0uIC8gLiAuLiAtLi4gLyAuLi4gLi4tIC0uIC4uIC0gLi4tIC0gLi0gLS0gLyAuLS4uIC0tLSAuLi4gLyAtLSAuLSAuLi0gLS0uLSAvIC0gLi0gLi0uIC4gLyAuLi4gLi4tIC4uIC0uLiAuLiAuLS4uIC4tIC0uLS4gLyAuLS4gLS0tIC0uLS4gLyAuLi4gLi4tIC4uIC4uLSAtLi0uIC8gLS0uLi0tIC4uIC4uLi0gLi0gLS0gLi0gLyAtLSAuIC4uLSAtLS4tIC4uIC4tLi4gLi0gLyAtLS0uLi4gLS0tIC4uIC0uLS4gLi4uIC8gLS0gLi4tIC0uIC4uLSAvIC4uIC0gLi0gLS4gLi0gLi4uIC8gLS0gLi0gLi4tIC0tLi0gLS0gLi4tIC0uIC8gLi4uIC4uIC4tLiAuIC0uIC4tLi4gLi4tIC4uLi0gLyAuIC4tIC4uIC4uLSAtLS4tIC4uIC4tLi4gLiAuLS4gLyAtLSAuLi0gLSAtLiAuLSAtIC8gLS4gLi0gLyAtLS4uLS0gLSAuLiAuLi4gLyAuLSAuLiAtIC0uIC4gLSAuLiAtLiAuIC4tIC4tLS4gLyAuIC4tLiAuIC4uLi0gLyAtLi0uIC0tLSAuLi4uIC8gLS0gLi4tIC4tLiAtIC4uLSAvIC0tLSAuLiAtLi0uIC4uLiAuIC0u";
        const SECRET_SONG_PLAYER_ID_PREFIX = 'secret-song-player';
        const YOUTUBE_VIDEO_ID_666 = 'CcnzvIM5XX0'; // Video ID untuk 666
        // GANTI ID VIDEO DI BAWAH INI UNTUK TRIGGER 777
        const YOUTUBE_VIDEO_ID_777 = 'bA9YxXkQ0f4'; // John Mayer - You're Gonna Live Forever in Me
        const YOUTUBE_VIDEO_ID_8427 = 'whoUiCIeke4'; // GANTI INI DENGAN ID VIDEO YANG BENAR

        // --- Secret Messages ---
const SECRET_MESSAGES_LIST = [
    "they stood silent where no light reached, their presence said nothing but meant everything. maybe it‚Äôs been said three times already, just never out loud.",
    "when a question is asked too many times and answered the same way, it stops being a question. maybe luck is just repetition in disguise.",
    "on that day wind didn‚Äôt move and time refused to count, something left the world quietly before april even blinked.",
    "the forty seventh day of the year once arrived with warmth and silence, no one noticed the start of a slow undoing.",
    "eight steps from the edge, one breath held, two echoes repeated, but the fourth never quite fit. break it in the middle and look again.",
    "the loop almost repeats but never does, the first fades, the second returns, after eight more you‚Äôll find two that refuse to leave.",
    "this is a shadow seen before, only backwards. don‚Äôt look forward, memory knows more than time.",
    "not built, but uncovered. the fourth sound runs in reverse, the last whisper leads the way. begin from the middle and wait for the shift.",
    "small and easily ignored, but it stood still while everything else ran. the first glitch is rarely loud.",
    "if you only saw numbers you missed it. if you felt something odd, you're closer than you think. three never returned. two still remember."
];

const SecretMessageManager = {
    container: null,
    currentMessageTimeout: null,
    messageLoopTimeout: null, // Menggunakan setTimeout untuk interval acak

    init: () => {
        SecretMessageManager.container = document.getElementById('secret-message-container');
        if (!SecretMessageManager.container) {
            SecretMessageManager.container = document.createElement('div');
            SecretMessageManager.container.id = 'secret-message-container';
            SecretMessageManager.container.setAttribute('aria-live', 'polite');
            // Kita akan append ke body di Cache jika Cache sudah terdefinisi, atau document.body jika belum
            const targetParent = Cache.body || document.body;
            targetParent.appendChild(SecretMessageManager.container);
        }
        // Penyesuaian styling awal jika diperlukan (misal warna font berdasarkan dark mode saat init)
        // sudah dihandle di displayMessage
    },

    getRandomMessage: () => {
        const randomIndex = Math.floor(Math.random() * SECRET_MESSAGES_LIST.length);
        return SECRET_MESSAGES_LIST[randomIndex];
    },

    displayMessage: () => {
        // Jangan tampilkan pesan jika masih di intro atau container tidak ada
        // Atau jika youtube video sedang aktif
        if (!SecretMessageManager.container ||
            (Cache.introSection && getComputedStyle(Cache.introSection).display !== 'none') ||
            (Cache.youtubeVideoOverlay && getComputedStyle(Cache.youtubeVideoOverlay).display === 'flex')) {
            return;
        }

        if (SecretMessageManager.currentMessageTimeout) {
            clearTimeout(SecretMessageManager.currentMessageTimeout);
        }
        SecretMessageManager.container.innerHTML = ''; // Hapus pesan sebelumnya

        const message = SecretMessageManager.getRandomMessage();
        const messageElement = document.createElement('span');
        messageElement.className = 'secret-message-item';
        messageElement.textContent = message;
        SecretMessageManager.container.appendChild(messageElement);

        const isDark = (Cache.body && Cache.body.classList.contains('dark-mode')) || document.body.classList.contains('dark-mode');
        SecretMessageManager.container.style.color = isDark ?
            getComputedStyle(document.documentElement).getPropertyValue('--story-text-color-dark') :
            getComputedStyle(document.documentElement).getPropertyValue('--story-text-color-light');

        SecretMessageManager.container.classList.add('visible');
        SecretMessageManager.container.classList.remove('hidden');

        // Sembunyikan container setelah animasi pesan selesai (2 detik) + sedikit buffer
        SecretMessageManager.currentMessageTimeout = setTimeout(() => {
            SecretMessageManager.container.classList.remove('visible');
            SecretMessageManager.container.classList.add('hidden');
        }, 4000); // Durasi pesan sama dengan animasi
    },

    startLoop: () => {
        if (SecretMessageManager.messageLoopTimeout) {
            clearTimeout(SecretMessageManager.messageLoopTimeout);
        }

        const showAndScheduleNext = () => {
            SecretMessageManager.displayMessage();
            // Interval acak antara 8000 ms (8 detik) dan 12000 ms (12 detik)
            // Total durasi = (2 detik pesan) + (6-10 detik jeda)
            const randomInterval = Math.random() * (10000 - 6000) + 6000; // Jeda acak 6-10 detik
            SecretMessageManager.messageLoopTimeout = setTimeout(showAndScheduleNext, 4000 + randomInterval); // 2 detik tampil + jeda
        };
        
        // Beri jeda sedikit sebelum pesan pertama muncul setelah main content tampil
        setTimeout(showAndScheduleNext, Math.random() * (3000 - 1000) + 1000);
    },

    stopLoop: () => { // Untuk menghentikan jika perlu
        if (SecretMessageManager.messageLoopTimeout) {
            clearTimeout(SecretMessageManager.messageLoopTimeout);
        }
        if (SecretMessageManager.currentMessageTimeout) {
            clearTimeout(SecretMessageManager.currentMessageTimeout);
        }
        if (SecretMessageManager.container) {
            SecretMessageManager.container.classList.remove('visible');
            SecretMessageManager.container.classList.add('hidden');
        }
    }
};
// --- End Secret Messages ---


        const PLAYERS_DATA = [ 
            { idPrefix: 'fuchsia',  track: { title: "Oblivium", artist: "nLebron James", src: "phase38.mp3" },  
              theme: { color: 'fuchsia', glow: 'fuchsia', mainTextColor: 'white', playerBoxBg: 'transparent', playerBoxText: 'white', seekBarThumb: 'white', logoSpin: 'spin-fuchsia'} },
            { idPrefix: 'emerald',  track: { title: "Exsilum Innocentiae", artist: "antisigma", src: "phase42.mp3" }, 
              theme: { color: '#2ecc71', glow: '#2ecc71', mainTextColor: 'white', playerBoxBg: 'white', playerBoxText: '#333', seekBarThumb: '#2ecc71', logoSpin: 'spin-emerald'} },
            { idPrefix: 'burgundy', track: { title: "Tenebris Speravi", artist: "zen", src: "phase43.mp3" }, 
              theme: { color: '#800020', glow: '#800020', mainTextColor: 'white', playerBoxBg: 'rgba(255,255,255,0.9)', playerBoxText: '#4c0013', seekBarThumb: '#800020', logoSpin: 'spin-burgundy'} },
            { idPrefix: 'ivory',    track: { title: "Lacrimae Obscurae", artist: "wiwok", src: "phasegiygas.mp3" }, 
              theme: { color: '#FFFFF0', glow: '#E0E0D0', mainTextColor: '#4A4A4A', playerBoxBg: '#F8F8F0', playerBoxText: '#505050', seekBarThumb: '#808078', logoSpin: 'spin-ivory'} }
        ];
        
        const NUMBER_TEXT_MAP = { 
            "12824": ".novem ,90x239 ,duo :memoriae fragmenta sunt numeri singuli ,mihi sed ,est numerus tantum fortasse mundo quod SMP‚Äù‚Ç¨√¢stat urbis corde in quae schola Ex", 
            "24812": ".magrep tu tse asuac aiuq des ,tse atciler aiuq non‚Äù‚Ç¨√¢tessiusop em tsop mae mutaf isauq ,tse atan oge mauq meid munu tsoP", 
            "82412": ".earbmu des ,sumus setsoh noN .subla te regiN .ilibarim ainomrah ni nemat ,atisoppo etrap ni snats‚Äù‚Ç¨√¢ogile murgin repmes iuq‚Äù‚Ç¨√¢metua ogE .taetal onnap bus diuq erediv rutnanoc irecnis mulos aiuq des ,tluv eretal aiuq non ,rutiget abla repmes suie seicaF", 
            "12248": ".erenam mucem essop ainmo non merecsid tu tua ,tabeipuc menidutilos aiuq essatroF .tisualc oirotaro ni em ,subitnelis subissap ,milO", 
            "24128": ".eravres matelpmocni nisohpromatem mae ididerc ,eid olli xe te‚Äù‚Ç¨√¢idiv lemes des ,tnuics senmo noN .tse sinoilipap muigitsev ,suie artsinis amlap nI", 
            "15": ".titnes cis es aspi aiuq essatrof‚Äù‚Ç¨√¢rutnuuqniler mudretni odnum a iuq‚Äù‚Ç¨√¢tigile sollI .titnes eneb es mucric silupicsid muc es repmes des ,melamrof maitneuqerf tama noN", 
            "888": ".ecov enis medif te sutca mutnat des ,tiderc non abrev ouq mudom ,suie muitnelis rep ixelletni des ,tebah eliciffid mediF", 
            "1212": ".lumis murhclup te snelod :sirolf sila muc mulet isauq ,tavres eclud mumsacras ,ae bus‚Äù‚Ç¨√¢evac deS .alliuqnart arepsev ni siunet aivulp tucis ,tse sillom suie xoV", 
            "2424": ".tidnetnoc esse sudigirf sudnum muc ,eritnes tedua aiuq :suie odutitrof tse coh ,ihim des ,tnacov metatimrifni coh itluM .titnes elicaf ,rutignat elicaF", 
            "119": ".tse aucav ohce mutnat susir ,ae enis aiuq :oednopser ,ted muvon musir sudnum sivmauq ,mis cih cuhda ruc sireauq iS .onimon malli ,oredised emixam meuq sireauq iS .onimon malli ,oma emixam meuq tis siuq sireauq is ...tE", 
            "269": ".tnus selibarepusni erev eamina madeauq aiuq des ...mus sumrifni aiuq non ,icsivilbo mussop noN", 
            "16": ".malli :menoitalpmetnoc manu retporp rabeuqes malc eauq avrap aigitsev des ,tnare sessalc mulos non essatroF .tiisnart G7 da otibus ednied ;C6 ,C5 ,C4 ,C3 ,C2 :tabedes ilibairavni arettil te subirapmi subissalc ni eauq alupicsiD"
        };
        
        let SECRET_SONG_TRIGGERS = {
            clearCalc: { count: 0, threshold: 24, song: { title: "ForF", artist: "YourForgottenGift", src: "happier.mp3", theme: {color: "#4A90E2", glow: "#81C784", playerBoxBg: "white", playerBoxText: "#333", seekBarThumb: "#4A90E2", mainTextColor: "white", logoSpin: "spin-secret-song-player"}}}, 
            dotCalc:   { count: 0, threshold: 24, song: { title: "Melukis Senja", artist: "Budi Doremi", src: "senja.mp3", theme: {color: "orange", glow: "darkorange", playerBoxBg: "white", playerBoxText: "#333", seekBarThumb: "orangered", mainTextColor: "white", logoSpin: "spin-secret-song-player"}}}, 
            dateTime:  { count: 0, threshold: 24, song: { title: "Ghost", artist: "Justin Bieber", src: "ghost.mp3", theme: {color: "grey", glow: "darkgrey", playerBoxBg: "#f0f0f0", playerBoxText: "#333", seekBarThumb: "dimgrey", mainTextColor: "#333", logoSpin: "spin-secret-song-player"}}}, 
            playerLogo:{ count: 0, threshold: 24, song: { title: "Golden Hour", artist: "JVKE", src: "goldenhour.mp3", theme: {color: "gold", glow: "yellow", playerBoxBg: "white", playerBoxText: "#333", seekBarThumb: "darkgoldenrod", mainTextColor: "#333", logoSpin: "spin-secret-song-player"}}}, 
            playerNext:{ count: 0, threshold: 24, song: { title: "Jangan Kau Lepas", artist: "Alexa", src: "mutia.mp3", theme: {color: "lightpink", glow: "deeppink", playerBoxBg: "white", playerBoxText: "#333", seekBarThumb: "hotpink", mainTextColor: "#333", logoSpin: "spin-secret-song-player"}}}, 
            playerPrev:{ count: 0, threshold: 24, song: { title: "Dear God", artist: "Avenged Sevenfold", src: "deargod.mp3", theme: {color: "#607D8B", glow: "#455A64", playerBoxBg: "white", playerBoxText: "#333", seekBarThumb: "#37474F", mainTextColor: "white", logoSpin: "spin-secret-song-player"}}}
        };
        
        // --- Utility Functions ---
        const Utils = {
            formatTime: (seconds) => {
                const m = Math.floor(seconds / 60);
                const s = Math.floor(seconds % 60);
                return `${m}:${s < 10 ? '0' : ''}${s}`;
            },
            debounce: (func, delay) => {
                let timeout;
                return (...args) => {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => func.apply(this, args), delay);
                };
            },
            isValidColor: (strColor) => {
                if (typeof chroma !== 'function') return false;
                try {
                    chroma(strColor);
                    return true;
                } catch (e) {
                    return false;
                }
            },
            getContrastingTextColor: (bgColor) => {
                if (typeof chroma !== 'function' || !Utils.isValidColor(bgColor)) return 'white'; 
                return chroma.contrast(bgColor, 'white') > chroma.contrast(bgColor, 'black') ? 'white' : 'black';
            }
        };

        // --- UI Management ---
        const UIManager = {
            toggleDarkMode: () => {
                State.isDarkMode = Cache.body.classList.toggle('dark-mode');
                UIManager.applyCurrentDarkModeStyles();
                try {
                    localStorage.setItem('darkMode', State.isDarkMode ? 'enabled' : 'disabled');
                } catch (e) { console.warn("Could not save dark mode preference to localStorage:", e); }
            },
            applyCurrentDarkModeStyles: () => {
                State.isDarkMode = Cache.body.classList.contains('dark-mode'); 
                if (Cache.storyTextParagraph && State.originalStoryTextHTML) {
                    if (Cache.mainContent && getComputedStyle(Cache.mainContent).display !== 'none') {
                        Cache.storyTextParagraph.innerHTML = State.isDarkMode ? MORSE_MESSAGE_FOR_STORY : State.originalStoryTextHTML;
                         Cache.storyTextParagraph.style.color = State.isDarkMode ? 
                            getComputedStyle(Cache.body).getPropertyValue('--story-text-color-dark') :
                            getComputedStyle(Cache.body).getPropertyValue('--story-text-color-light');
                    }
                }

                if (Cache.nextButtonMainPage && Cache.nextButtonMainPage.disabled && Cache.nextButtonMainPage.textContent.startsWith("Tunggu")) {
                    Cache.nextButtonMainPage.style.backgroundColor = "#cccccc"; 
                    Cache.nextButtonMainPage.style.color = "#666666";
                } else if (Cache.nextButtonMainPage) {
                    Cache.nextButtonMainPage.style.backgroundColor = State.isDarkMode ? 
                        getComputedStyle(Cache.body).getPropertyValue('--button-bg-dark') : 
                        getComputedStyle(Cache.body).getPropertyValue('--button-bg-light');
                    Cache.nextButtonMainPage.style.color = State.isDarkMode ? 
                        getComputedStyle(Cache.body).getPropertyValue('--button-text-dark') : 
                        getComputedStyle(Cache.body).getPropertyValue('--button-text-light');
                }

                if (State.activePlayerElements.container && State.activePlayerConfig.theme) {
                    PlayerManager.applyThemeStyles(State.activePlayerElements, State.activePlayerConfig.theme);
                }
            },
            setWidgetVisibility: (visible) => {
                const displayStyle = visible ? 'block' : 'none'; 
                const activeClass = 'widget-active';
                
                if (Cache.calculatorWidget) {
                    Cache.calculatorWidget.style.display = displayStyle;
                    if(visible) Cache.calculatorWidget.classList.add(activeClass);
                    else Cache.calculatorWidget.classList.remove(activeClass);
                }
                if (Cache.dateTimeWidget) {
                    Cache.dateTimeWidget.style.display = displayStyle;
                     if(visible) Cache.dateTimeWidget.classList.add(activeClass);
                    else Cache.dateTimeWidget.classList.remove(activeClass);
                }
            },
            showScaryOverlayText: () => {
                if (Cache.scaryTextOverlay) {
                    Cache.scaryTextOverlay.style.display = 'block';
                     Cache.scaryTextOverlay.addEventListener('animationend', () => {
                        Cache.scaryTextOverlay.style.display = 'none';
                    }, { once: true });
                }
            },
            createFireNumber: () => {
                if (!Cache.fireBackground) return;
                const d = document.createElement('div');
                d.className = 'fire-number';
                d.textContent = Math.floor(Math.random() * 17) + 8; 
                d.style.left = `${Math.random() * 100}vw`;
                d.style.animationDuration = `${Math.random() * 2 + 2}s`; 
                Cache.fireBackground.appendChild(d);
                setTimeout(() => {
                    if (Cache.fireBackground.contains(d)) Cache.fireBackground.removeChild(d);
                }, parseFloat(d.style.animationDuration) * 1000 + 500);
            },
            startButtonTimer: (buttonElement, durationSeconds) => {
                if (!buttonElement) return;
                if (State.nextButtonTimerId) clearInterval(State.nextButtonTimerId); 

                buttonElement.disabled = true;
                let countdown = durationSeconds;

                const updateButtonText = () => {
                    const minutes = Math.floor(countdown / 60);
                    const seconds = countdown % 60;
                    buttonElement.textContent = `Tunggu ${minutes} menit ${seconds} detik...`;
                    buttonElement.style.backgroundColor = "#cccccc"; 
                    buttonElement.style.color = "#666666";
                };

                updateButtonText(); 

                State.nextButtonTimerId = setInterval(() => {
                    countdown--;
                    if (countdown <= 0) {
                        clearInterval(State.nextButtonTimerId);
                        State.nextButtonTimerId = null;
                        buttonElement.disabled = false;
                        buttonElement.textContent = "Lanjutkan";
                        UIManager.applyCurrentDarkModeStyles(); 
                    } else {
                        updateButtonText();
                    }
                }, 1000);
            },
            updateMainCountdown: () => {
                if (!Cache.countdownElement) return;
                if (State.countdownTime > 0) State.countdownTime--;

                let hours = Math.floor(State.countdownTime / 3600);
                let minutes = Math.floor((State.countdownTime % 3600) / 60);
                let seconds = State.countdownTime % 60;

                if (State.countdownTime <= 0) {
                    Cache.countdownElement.textContent = "The time has come.";
                } else {
                    let parts = [];
                    if (hours > 0) parts.push(`${hours.toLocaleString()} hour${hours > 1 ? 's' : ''}`);
                    if (minutes > 0) parts.push(`${minutes.toLocaleString()} minute${minutes > 1 ? 's' : ''}`);
                    if (seconds > 0 || (hours === 0 && minutes === 0)) parts.push(`${seconds} second${seconds > 1 ? 's' : ''}`);
                    Cache.countdownElement.textContent = `${parts.join(', ')} before her death`;
                }
            },
            displayTemporaryText: (text) => { 
                const existingOverlay = document.getElementById('temp-text-overlay');
                if (existingOverlay) existingOverlay.remove();

                const el = document.createElement("div");
                el.id = 'temp-text-overlay';
                Object.assign(el.style, {
                    position:"fixed", top:"50%", left:"50%", transform:"translate(-50%, -50%)",
                    fontFamily:"'Courier New', monospace", fontSize:"20px", color:"red",
                    textAlign:"center", zIndex:"99999", padding:"20px",
                    backgroundColor:"black", border:"2px solid red",
                    boxShadow:"0 0 10px red", borderRadius:"10px",
                    maxWidth:"80%", overflowWrap:"break-word",
                    maxHeight: "70vh", overflowY: "auto"
                });
                el.textContent = text;
                Cache.body.appendChild(el);
                setTimeout(() => {
                    if (Cache.body.contains(el)) Cache.body.removeChild(el);
                }, 5000); 
            }
        };

        // --- Effects & Special Triggers ---
        const Effects = {
            preventScreenshotAndRecording: () => {
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'PrintScreen') {
                        e.preventDefault();
                        UIManager.displayTemporaryText('Apasih kids sono belajar bahasa lain wibu');
                        if (navigator.clipboard && navigator.clipboard.writeText) {
                            navigator.clipboard.writeText('')
                                .catch(err => console.warn('Could not clear clipboard:', err));
                        }
                    }
                });
            },
            triggerScaryEffectDateTime: () => {
                State.isScaryEffectActive = true; // Tandai efek aktif
                const originalBodyStyle = { 
                    background: Cache.body.style.background,
                    backgroundImage: Cache.body.style.backgroundImage,
                    backgroundColor: Cache.body.style.backgroundColor,
                    color: Cache.body.style.color
                };
                
                const scaryTextElement = document.createElement('div');
                scaryTextElement.id = 'temp-scary-overlay';
                scaryTextElement.textContent = "Ultimus secundus transiit, et iam mortuus est. Cur adhuc caecos vos geritis adversus crudelitatem mundi digitalis? Ille e stirpe clarissima ortus est, patriae beneficio natus. Sed oppressus tempestatibus cyberneticis, animo fracto, in tenebras descendit. Morbus mentis eum devoravit. Et vos... adhuc dormitis? O vos stulti, vos creduli: in caede partem habuistis. Peccatum in animis vestris manebit, donec verba vestra venenata evanescant‚Äîaut vos ipsos damnatio excutiat.";
                Object.assign(scaryTextElement.style, {
                    position:"fixed", top:"50%", left:"50%", transform:"translate(-50%, -50%)",
                    fontFamily:"'Courier New', monospace", fontSize:"20px", textAlign:"center",
                    zIndex:"100000", color:"red", maxWidth:"90%", overflowWrap:"break-word",
                    backgroundColor:"rgba(0,0,0,0.85)", padding:"20px", borderRadius:"10px",
                    border: "2px solid red", boxShadow: "0 0 20px red"
                });

                const skullImage = document.createElement('img');
                skullImage.id = 'temp-scary-skull';
                skullImage.src = "https://i.ibb.co.com/2Yns3fLz/no-Filter-remove-bg-io.png"; 
                Object.assign(skullImage.style, {
                    position:"fixed", top:"50%", left:"50%", transform:"translate(-50%, calc(-50% - 100px))", 
                    width:"120px", height:"120px", zIndex:"99999", display:"none", filter: "drop-shadow(0 0 10px red)"
                });

                Cache.body.appendChild(scaryTextElement);
                Cache.body.appendChild(skullImage);

                let isBlack = true;
                const glitchInterval = setInterval(() => {
                    Cache.body.style.backgroundColor = isBlack ? "black" : "red";
                    Cache.body.style.backgroundImage = "none";
                    Cache.body.style.color = isBlack ? "red" : "black";
                    scaryTextElement.style.color = isBlack ? "red" : "black";
                    scaryTextElement.style.backgroundColor = isBlack ? "rgba(0,0,0,0.85)" : "rgba(50,0,0,0.85)";
                    skullImage.style.display = isBlack ? "block" : "none";
                    isBlack = !isBlack;
                }, 100);

                setTimeout(() => {
                    clearInterval(glitchInterval);
                    Cache.body.style.background = originalBodyStyle.background;
                    Cache.body.style.backgroundImage = originalBodyStyle.backgroundImage;
                    Cache.body.style.backgroundColor = originalBodyStyle.backgroundColor;
                    Cache.body.style.color = originalBodyStyle.color;
                    
                    if (!State.isDarkMode && !originalBodyStyle.backgroundColor && !originalBodyStyle.backgroundImage) {
                         Cache.body.style.backgroundImage = getComputedStyle(document.documentElement).getPropertyValue('--bg-gradient-light');
                    } else if (State.isDarkMode) {
                        Cache.body.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--bg-color-dark');
                    }


                    if (Cache.body.contains(scaryTextElement)) Cache.body.removeChild(scaryTextElement);
                    if (Cache.body.contains(skullImage)) Cache.body.removeChild(skullImage);
                    
                    UIManager.applyCurrentDarkModeStyles(); 
                    State.dateTimeLogoClickCount = 0; 
                    State.isScaryEffectActive = false; // Tandai efek selesai
                }, 4000);
            }
        };

      // --- Calculator Logic ---
      const Calculator = {
            updateDisplay: (value) => {
                if (Cache.calcDisplay) Cache.calcDisplay.textContent = value || '0';
            },
            calculate: (a, b, op) => {
                a = parseFloat(a); b = parseFloat(b);
                if (isNaN(a) || isNaN(b)) return 'Error';
                switch (op) {
                    case '+': return a + b;
                    case '-': return a - b;
                    case '*': return a * b;
                    case '/': return b !== 0 ? a / b : 'Error';
                    default: return b;
                }
            },
            handleInput: (value) => {
                if (!isNaN(parseInt(value)) && value !== '.') { // Check if it's a digit
                    // --- AWAL BAGIAN PENGECEKAN SEQUENCE (BISA RETURN) ---

                    // Handle 666 sequence
                    State.calcInputSequence666.push(value);
                    if (State.calcInputSequence666.join('') === '666') {
                        YouTubePlayer.showVideoById(YOUTUBE_VIDEO_ID_666, true); // true for audio
                        State.calcInputSequence666 = [];
                        State.calcInputSequence777 = [];
                        State.calcInputSequence328 = []; // Pastikan semua sequence direset
                        State.currentCalcInput = '';
                        State.previousCalcInput = '';
                        State.calcOperator = null;
                        Calculator.updateDisplay('');
                        return; // Keluar jika 666 terpicu
                    } else if (State.calcInputSequence666.length > 3) {
                        State.calcInputSequence666.shift();
                    }

                    // Handle 777 sequence
                    State.calcInputSequence777.push(value);
                    if (State.calcInputSequence777.join('') === '777') {
                        YouTubePlayer.showVideoById(YOUTUBE_VIDEO_ID_777, true); // true for audio
                        State.calcInputSequence777 = [];
                        State.calcInputSequence666 = [];
                        State.calcInputSequence328 = []; // Pastikan semua sequence direset
                        State.currentCalcInput = '';
                        State.previousCalcInput = '';
                        State.calcOperator = null;
                        Calculator.updateDisplay('');
                        return; // Keluar jika 777 terpicu
                    } else if (State.calcInputSequence777.length > 3) {
                        State.calcInputSequence777.shift();
                    }

                    // Handle 328 sequence
                    if (State.is328TriggerEnabled) {
                        State.calcInputSequence328.push(value);
                        if (State.calcInputSequence328.join('') === '328') {
                            LocalVideoManager.showPlayer('secretvideo.mp4');
                            State.calcInputSequence328 = [];
                            State.calcInputSequence666 = []; // Pastikan semua sequence direset
                            State.calcInputSequence777 = [];
                            State.currentCalcInput = '';
                            State.previousCalcInput = '';
                            State.calcOperator = null;
                            Calculator.updateDisplay('');
                            return; // Keluar jika 328 terpicu
                        } else if (State.calcInputSequence328.length > 3) {
                            State.calcInputSequence328.shift();
                        }
                    }

                    State.calcInputSequence8427.push(value);
                    if (State.calcInputSequence8427.join('') === '8427') {
                        YouTubePlayer.showVideoById(YOUTUBE_VIDEO_ID_8427, true); // true untuk audio
                        State.calcInputSequence8427 = [];
                        State.calcInputSequence666 = [];
                        State.calcInputSequence777 = [];
                        State.calcInputSequence328 = [];
                        State.currentCalcInput = '';
                        State.previousCalcInput = '';
                        State.calcOperator = null;
                        Calculator.updateDisplay('');
                        return; // Keluar jika 8427 terpicu
                    } else if (State.calcInputSequence8427.length > 4) { // Jaga panjang sequence
                        State.calcInputSequence8427.shift();
                    }

                    State.calcInputSequence115.push(value);
                    if (State.calcInputSequence115.join('') === '115') {
                        PlayerManager.playSecretSong({
                            title: "Mesin Waktu",
                            artist: "Budi Doremi",
                            src: "mesin.mp3", // Pastikan file mesin.mp3 ada di path yang benar
                            theme: { // Anda bisa mendefinisikan tema spesifik atau menggunakan default
                                color: "#4DB6AC", // Contoh warna Teal
                                glow: "#80CBC4",
                                playerBoxBg: "rgba(255,255,255,0.9)",
                                playerBoxText: "#004D40",
                                seekBarThumb: "#00796B",
                                mainTextColor: "white",
                                logoSpin: "spin-secret-song-player"
                            }
                        });
                        State.calcInputSequence115 = [];
                        State.calcInputSequence666 = [];
                        State.calcInputSequence777 = [];
                        State.calcInputSequence328 = [];
                        State.calcInputSequence8427 = [];
                        State.currentCalcInput = '';
                        State.previousCalcInput = '';
                        State.calcOperator = null;
                        Calculator.updateDisplay('');
                        return; // Keluar jika 115 terpicu
                    } else if (State.calcInputSequence115.length > 3) { // Jaga panjang sequence
                        State.calcInputSequence115.shift();
                    }
                    // AKHIR LOGIKA BARU UNTUK 115


                    State.calcInputSequence2022.push(value);
                    if (State.calcInputSequence2022.join('') === '2022') {
                        PlayerManager.playSecretSong({
                            title: "Burning Memory",
                            artist: "The Caretaker",
                            src: "memory.mp3", // PASTIKAN FILE "memory.mp3" ADA DI FOLDER YANG SAMA DENGAN HTML
                            theme: { // Anda bisa membuat tema unik atau menggunakan tema default secret player
                                color: "#5D4037", // Contoh warna: Coklat tua (mencerminkan nuansa lagu)
                                glow: "#8D6E63",
                                playerBoxBg: "rgba(46, 46, 36, 0.85)", // Latar belakang kotak pemain agak gelap
                                playerBoxText: "#E0E0E0", // Teks terang
                                seekBarThumb: "#A1887F", // Warna thumb seek bar
                                mainTextColor: "#E0E0E0", // Teks utama player
                                logoSpin: "spin-secret-song-player" // Atau buat animasi spin baru jika perlu
                            }
                        });
                        // Reset semua sequence kalkulator agar tidak ada konflik
                        State.calcInputSequence2022 = [];
                        State.calcInputSequence666 = [];
                        State.calcInputSequence777 = [];
                        State.calcInputSequence328 = [];
                        State.calcInputSequence8427 = [];
                        State.calcInputSequence115 = [];
                        // Kosongkan input kalkulator saat ini
                        State.currentCalcInput = '';
                        State.previousCalcInput = '';
                        State.calcOperator = null;
                        Calculator.updateDisplay(''); // Kosongkan display kalkulator
                        return; // Keluar dari fungsi handleInput karena lagu rahasia dipicu
                    } else if (State.calcInputSequence2022.length > 4) { // Jaga agar panjang array tidak lebih dari 4 (jumlah digit di "2022")
                        State.calcInputSequence2022.shift(); // Hapus digit pertama jika lebih dari 4
                    }
                    // AKHIR BLOK LOGIKA BARU UNTUK 2022

                    // --- AKHIR BAGIAN PENGECEKAN SEQUENCE ---

                    // Jika tidak ada sequence yang terpicu dan keluar (return),
                    // maka proses sebagai input digit kalkulator reguler.
                    // Ini hanya akan dieksekusi jika tidak ada 'return' dari blok di atas.
                    
                    if (State.currentCalcInput.includes('.') && value === '.') {
                        // Ini seharusnya tidak terjadi karena kita sudah di blok digit, 
                        // tapi sebagai pengaman jika 'value' ternyata '.', walau sudah dicek di if utama.
                        return; 
                    }
                    State.currentCalcInput += value;
                    Calculator.updateDisplay(State.currentCalcInput);

                    // Logika untuk pemicu teks dari NUMBER_TEXT_MAP dan links
                    State.calcInputSequence.push(value);
                    const sequenceStr = State.calcInputSequence.join('');
                    if (NUMBER_TEXT_MAP[sequenceStr]) {
                        UIManager.displayTemporaryText(NUMBER_TEXT_MAP[sequenceStr]);
                        State.calcInputSequence = [];
                    }
                    const links = {
                        "3264": "https://ibb.co.com/PsStWqdP",
                        "6529": "https://ibb.co.com/HT4pzqh2",
                        "81224": "https://ibb.co.com/SXZw0qFS",
                        "21610": "https://youtu.be/ACQNclEiq00",
                        "21510": "https://www.mediafire.com/file/nt4z3eob4d91spz/fallen_white_knight_unfinished_ver_4.docx/file"
                    };
                    if (links[sequenceStr]) {
                        window.open(links[sequenceStr], '_blank');
                        State.calcInputSequence = [];
                    }
                    if (State.calcInputSequence.length > 10) {
                        State.calcInputSequence.shift();
                    }

                } else { // Not a digit (operator, C, =, .)
                    // Jika tombol yang ditekan bukan digit (misal: +, -, *, /, C, =, .)
                    // Reset semua sequence digit
                    if (value !== '.') { // Jangan reset jika tombolnya adalah '.', karena titik masih bisa jadi bagian dari input
                        State.calcInputSequence666 = [];
                        State.calcInputSequence777 = [];
                        State.calcInputSequence328 = [];
                        State.calcInputSequence8427 = []; 
                        State.calcInputSequence115 = [];
                        State.calcInputSequence2022 = [];
                    }
                    // Untuk 'calcInputSequence' (yang untuk NUMBER_TEXT_MAP), direset sesuai kebutuhan pada operator tertentu

                    if (value === '.') {
                        if (State.currentCalcInput.includes('.')) return;
                        State.currentCalcInput += value;
                        Calculator.updateDisplay(State.currentCalcInput);
                        // Dot specific secret trigger handled in event listener
                        // Karena '.' juga bukan digit, perlu dipertimbangkan apakah ingin mereset
                        // sequence 666, 777, 328 di sini juga.
                        // Berdasarkan logika Anda sebelumnya, '.' TIDAK mereset sequence tersebut.
                        // Jadi, jika 'value' adalah '.', baris di atas (if value !== '.') tidak akan
                        // mereset sequence, dan itu konsisten.
                    } else if (['+', '-', '*', '/'].includes(value)) {
                        if (State.currentCalcInput === '' && State.previousCalcInput === '') return;
                        if (State.currentCalcInput !== '') {
                            if (State.previousCalcInput !== '' && State.calcOperator) {
                                const result = Calculator.calculate(State.previousCalcInput, State.currentCalcInput, State.calcOperator);
                                Calculator.updateDisplay(result);
                                State.previousCalcInput = result.toString();
                            } else {
                                State.previousCalcInput = State.currentCalcInput;
                            }
                        }
                        State.calcOperator = value;
                        State.currentCalcInput = '';
                        State.calcInputSequence = []; // Reset untuk NUMBER_TEXT_MAP
                    } else if (value === '=') {
                        if (State.currentCalcInput === '' || State.previousCalcInput === '' || !State.calcOperator) return;
                        const result = Calculator.calculate(State.previousCalcInput, State.currentCalcInput, State.calcOperator);
                        Calculator.updateDisplay(result);
                        State.currentCalcInput = result.toString();
                        State.previousCalcInput = '';
                        State.calcOperator = null;
                        State.calcInputSequence = []; // Reset untuk NUMBER_TEXT_MAP
                    } else if (value === 'C') {
                        State.currentCalcInput = ''; State.previousCalcInput = ''; State.calcOperator = null;
                        Calculator.updateDisplay('0');
                        State.calcInputSequence = []; // Reset untuk NUMBER_TEXT_MAP
                        // Reset juga sequence rahasia karena 'C' adalah clear all
                        State.calcInputSequence666 = [];
                        State.calcInputSequence777 = [];
                        State.calcInputSequence328 = [];
                        State.calcInputSequence8427 = [];
                        State.calcInputSequence115 = [];
                        State.calcInputSequence2022 = [];
                    }
                }
            }
        };



        // --- Music Player Management ---
        const PlayerManager = {
            getPlayerElements: (idPrefix) => {
                const container = document.getElementById(`music-player-container-${idPrefix}`);
                if (!container) return {}; 
                return {
                    container,
                    audio: document.getElementById(`audio-player-${idPrefix}`),
                    playPauseBtn: document.getElementById(`play-pause-button-${idPrefix}`),
                    nextBtn: document.getElementById(`next-button-${idPrefix}`), 
                    prevBtn: document.getElementById(`prev-button-${idPrefix}`),
                    seekBar: document.getElementById(`seek-bar-${idPrefix}`),
                    titleEl: document.getElementById(`track-title-${idPrefix}`),
                    artistEl: document.getElementById(`track-artist-${idPrefix}`),
                    currentTimeEl: document.getElementById(`current-time-${idPrefix}`),
                    totalDurationEl: document.getElementById(`total-duration-${idPrefix}`),
                    logoBg: document.getElementById(`player-logo-background-${idPrefix}`),
                    logoImg: document.getElementById(`player-aetherx-logo-${idPrefix}`)
                };
            },
            applyThemeStyles: (elements, themeConfig) => {
                if (!elements.container || !themeConfig) return;
                const style = elements.container.style;
                const isDark = Cache.body.classList.contains('dark-mode');
                
                style.setProperty('--player-bg-color', themeConfig.color || (isDark ? '#333' : '#777'));
                style.setProperty('--player-glow-color', themeConfig.glow || themeConfig.color || (isDark ? '#555' : 'transparent'));
                style.setProperty('--player-text-color', themeConfig.mainTextColor || (isDark ? '#e0e0e0' : 'white'));
                style.setProperty('--player-main-box-bg', themeConfig.playerBoxBg || (isDark ? getComputedStyle(document.documentElement).getPropertyValue('--player-main-box-bg-dark') : 'transparent'));
                style.setProperty('--player-main-box-text-color', themeConfig.playerBoxText || (isDark ? getComputedStyle(document.documentElement).getPropertyValue('--player-main-box-text-color-dark') : style.getPropertyValue('--player-text-color')));
                style.setProperty('--player-track-title-color', themeConfig.playerBoxText || (isDark ? getComputedStyle(document.documentElement).getPropertyValue('--player-track-title-color-dark') : style.getPropertyValue('--player-text-color')));
                style.setProperty('--player-track-artist-color', themeConfig.playerBoxText || (isDark ? getComputedStyle(document.documentElement).getPropertyValue('--player-track-artist-color-dark') : style.getPropertyValue('--player-text-color')));
                style.setProperty('--player-time-display-color', themeConfig.playerBoxText || (isDark ? getComputedStyle(document.documentElement).getPropertyValue('--player-time-display-color-dark') : style.getPropertyValue('--player-text-color')));

                const thumbColor = themeConfig.seekBarThumb || (isDark ? '#bbb' : 'white');
                style.setProperty('--player-seekbar-thumb-color', thumbColor);
                if (typeof chroma === 'function' && Utils.isValidColor(thumbColor)) {
                    style.setProperty('--player-seekbar-track-color', chroma(thumbColor).alpha(isDark ? 0.4 : 0.3).hex());
                    style.setProperty('--player-seekbar-track-hover-color', chroma(thumbColor).alpha(isDark ? 0.6 : 0.5).hex());
                    style.setProperty('--player-seekbar-thumb-shadow-color', chroma(thumbColor).alpha(0.9).hex());
                } else { 
                    style.setProperty('--player-seekbar-track-color', isDark ? 'rgba(180,180,180,0.4)' : 'rgba(255,255,255,0.3)');
                    style.setProperty('--player-seekbar-track-hover-color', isDark ? 'rgba(180,180,180,0.6)' : 'rgba(255,255,255,0.5)');
                    style.setProperty('--player-seekbar-thumb-shadow-color', isDark ? 'rgba(180,180,180,0.9)' : 'rgba(255,255,255,0.9)');
                }
                
                const defaultButtonBg = themeConfig.playerBoxBg !== 'transparent' ? (themeConfig.playerBoxText || (isDark ? '#444' : '#ddd')) : 'transparent';
                const defaultButtonTextColor = themeConfig.playerBoxBg !== 'transparent' ? Utils.getContrastingTextColor(defaultButtonBg) : (themeConfig.mainTextColor || (isDark ? '#e0e0e0' : 'white'));
                const defaultButtonBorderColor = defaultButtonTextColor;

                style.setProperty('--player-button-bg', themeConfig.buttonBg || defaultButtonBg);
                style.setProperty('--player-button-text-color', themeConfig.buttonTextColor || defaultButtonTextColor);
                style.setProperty('--player-button-border-color', themeConfig.buttonBorderColor || defaultButtonBorderColor);
                style.setProperty('--player-button-hover-bg', themeConfig.buttonHoverBg || (typeof chroma === 'function' && Utils.isValidColor(style.getPropertyValue('--player-button-bg')) ? chroma(style.getPropertyValue('--player-button-bg')).brighten(0.5).hex() : (isDark ? '#555' : 'rgba(255,255,255,0.3)')));

                const playPauseBg = themeConfig.seekBarThumb || (isDark ? '#bb86fc' : '#007BFF'); 
                style.setProperty('--player-playpause-button-bg', playPauseBg);
                style.setProperty('--player-playpause-button-text-color', Utils.getContrastingTextColor(playPauseBg));

                style.setProperty('--player-logo-spin-animation', themeConfig.logoSpin || 'spin-default');
            },
            loadTrack: (elements, trackData, themeConfig) => {
                if (!elements.audio || !trackData || !elements.titleEl) return;
                elements.titleEl.textContent = trackData.title;
                elements.artistEl.textContent = trackData.artist;
                elements.audio.src = trackData.src;
                elements.audio.load(); 

                if (elements.seekBar) elements.seekBar.value = 0;
                if (elements.currentTimeEl) elements.currentTimeEl.textContent = Utils.formatTime(0);
                if (elements.totalDurationEl) elements.totalDurationEl.textContent = Utils.formatTime(0); 
                if (elements.playPauseBtn) elements.playPauseBtn.textContent = '‚ñ∫';
                if (elements.logoBg) elements.logoBg.classList.remove('playing');
                
                PlayerManager.applyThemeStyles(elements, themeConfig);
            },
            togglePlayPause: (elements) => {
                if (!elements.audio || !elements.playPauseBtn) return;
                if (elements.audio.paused || elements.audio.ended) {
                    elements.audio.play()
                        .then(() => {
                            elements.playPauseBtn.textContent = '‚ùö‚ùö'; 
                            if (elements.logoBg) elements.logoBg.classList.add('playing');
                        })
                        .catch(e => console.error(`Player (${elements.container ? elements.container.id : 'N/A'}) play error:`, e));
                } else {
                    elements.audio.pause();
                    elements.playPauseBtn.textContent = '‚ñ∫'; 
                    if (elements.logoBg) elements.logoBg.classList.remove('playing');
                }
            },
            setupEventListeners: (elements, playerType, config) => {
                if (!elements.audio || !elements.playPauseBtn || !elements.seekBar) return;

                const clearAndAdd = (el, event, handler) => {
                    if (el._eventHandlers && el._eventHandlers[event]) {
                        el.removeEventListener(event, el._eventHandlers[event]);
                    }
                    if (!el._eventHandlers) el._eventHandlers = {};
                    el._eventHandlers[event] = handler;
                    el.addEventListener(event, handler);
                };
                
                clearAndAdd(elements.playPauseBtn, 'click', () => PlayerManager.togglePlayPause(elements));

                const setupInteractiveButton = (button, secretTriggerKey, action) => {
                    if (button) {
                         clearAndAdd(button, 'click', () => {
                            if (secretTriggerKey) SecretManager.handleTrigger(secretTriggerKey);
                            action();
                        });
                    }
                };

                if (playerType === 'main') {
                    setupInteractiveButton(elements.nextBtn, 'playerNext', () => 
                        PlayerManager.switchToPlayer((State.currentPlayerIndex + 1) % PLAYERS_DATA.length, 'main')
                    );
                    setupInteractiveButton(elements.prevBtn, 'playerPrev', () => 
                        PlayerManager.switchToPlayer((State.currentPlayerIndex - 1 + PLAYERS_DATA.length) % PLAYERS_DATA.length, 'main')
                    );
                     if(elements.logoImg) { 
                        setupInteractiveButton(elements.logoImg, 'playerLogo', () => {}); 
                    }
                } else if (playerType === 'secret') {
                    setupInteractiveButton(elements.nextBtn, null, () => { 
                        if (elements.container) elements.container.style.display = 'none';
                        if (elements.audio && !elements.audio.paused) elements.audio.pause();
                        PlayerManager.switchToPlayer(State.currentPlayerIndex, 'main'); 
                    });
                    if (elements.prevBtn) elements.prevBtn.style.display = 'none'; 
                }

                const audio = elements.audio;
                clearAndAdd(audio, 'timeupdate', () => {
                    if (!isNaN(audio.duration) && elements.seekBar && elements.currentTimeEl) {
                        elements.seekBar.value = audio.currentTime;
                        elements.currentTimeEl.textContent = Utils.formatTime(audio.currentTime);
                    }
                });
                clearAndAdd(audio, 'loadedmetadata', () => {
                    if (!isNaN(audio.duration) && elements.totalDurationEl && elements.seekBar) {
                        elements.totalDurationEl.textContent = Utils.formatTime(audio.duration);
                        elements.seekBar.max = audio.duration;
                    } else {
                        if(elements.totalDurationEl) elements.totalDurationEl.textContent = "N/A";
                        if(elements.seekBar) elements.seekBar.max = 0;
                    }
                });
                clearAndAdd(audio, 'ended', () => {
                    if (elements.playPauseBtn) elements.playPauseBtn.textContent = '‚ñ∫';
                    if (elements.logoBg) elements.logoBg.classList.remove('playing');
                    if (elements.seekBar) elements.seekBar.value = 0; 
                    if (playerType === 'secret') { 
                        if (elements.container) elements.container.style.display = 'none';
                        PlayerManager.switchToPlayer(State.currentPlayerIndex, 'main');
                    }
                });

                clearAndAdd(elements.seekBar, 'input', () => { 
                    if (!isNaN(elements.audio.duration)) elements.audio.currentTime = elements.seekBar.value;
                });
                 clearAndAdd(elements.seekBar, 'change', () => { 
                    if (!isNaN(elements.audio.duration)) elements.audio.currentTime = elements.seekBar.value;
                });
            },
            setActivePlayerAnimated: (elements) => {
                if (!elements || !elements.container) return;
                PLAYERS_DATA.forEach(pd => {
                    const p = PlayerManager.getPlayerElements(pd.idPrefix);
                    if (p.container) p.container.classList.remove('player-active-animation');
                });
                const secretP = PlayerManager.getPlayerElements(SECRET_SONG_PLAYER_ID_PREFIX);
                if (secretP.container) secretP.container.classList.remove('player-active-animation');

                elements.container.style.display = 'flex';
                elements.container.classList.remove('player-active-animation'); 
                void elements.container.offsetWidth; 
                elements.container.classList.add('player-active-animation');
            },
            switchToPlayer: (index, type) => {
                PLAYERS_DATA.forEach(pd => {
                    const pElements = PlayerManager.getPlayerElements(pd.idPrefix);
                    if (pElements.container) {
                        pElements.container.style.display = 'none';
                        pElements.container.classList.remove('player-active-animation'); 
                    }
                    if (pElements.audio && !pElements.audio.paused) {
                        pElements.audio.pause();
                        if (pElements.playPauseBtn) pElements.playPauseBtn.textContent = '‚ñ∫';
                        if (pElements.logoBg) pElements.logoBg.classList.remove('playing');
                    }
                });
                const secretPlayerElements = PlayerManager.getPlayerElements(SECRET_SONG_PLAYER_ID_PREFIX);
                if (secretPlayerElements.container && secretPlayerElements.container.style.display !== 'none') {
                    secretPlayerElements.container.style.display = 'none';
                    secretPlayerElements.container.classList.remove('player-active-animation');
                    if (secretPlayerElements.audio && !secretPlayerElements.audio.paused) {
                        secretPlayerElements.audio.pause();
                         if (secretPlayerElements.playPauseBtn) secretPlayerElements.playPauseBtn.textContent = '‚ñ∫';
                         if (secretPlayerElements.logoBg) secretPlayerElements.logoBg.classList.remove('playing');
                    }
                }
                
                State.activePlayerType = type;

                if (type === 'main') {
                    State.currentPlayerIndex = index;
                    const playerData = PLAYERS_DATA[index];
                    if (!playerData) { console.warn(`Player data not found for index: ${index}`); return; }
                    State.activePlayerConfig = playerData;
                    State.activePlayerElements = PlayerManager.getPlayerElements(playerData.idPrefix);
                    
                    if (State.activePlayerElements.container) {
                        PlayerManager.loadTrack(State.activePlayerElements, playerData.track, playerData.theme);
                        PlayerManager.setupEventListeners(State.activePlayerElements, 'main', playerData);
                        PlayerManager.setActivePlayerAnimated(State.activePlayerElements); 
                    } else {
                         console.warn(`Container for player ${playerData.idPrefix} not found.`);
                    }
                } 
                 UIManager.applyCurrentDarkModeStyles(); 
            },
            playSecretSong: (songDataWithTheme) => {
                if (State.activePlayerType === 'main' && State.activePlayerElements.container) {
                    State.activePlayerElements.container.style.display = 'none';
                     State.activePlayerElements.container.classList.remove('player-active-animation');
                    if (State.activePlayerElements.audio && !State.activePlayerElements.audio.paused) {
                        State.activePlayerElements.audio.pause();
                        if(State.activePlayerElements.playPauseBtn) State.activePlayerElements.playPauseBtn.textContent = '‚ñ∫';
                        if(State.activePlayerElements.logoBg) State.activePlayerElements.logoBg.classList.remove('playing');
                    }
                }

                const secretElements = PlayerManager.getPlayerElements(SECRET_SONG_PLAYER_ID_PREFIX);
                if (!secretElements.container) { console.error("Secret song player container not found!"); return; }
                
                if (songDataWithTheme && songDataWithTheme.src) {
                    const themeForSecret = songDataWithTheme.theme || {}; 
                    State.activePlayerConfig = { track: songDataWithTheme, theme: themeForSecret, idPrefix: SECRET_SONG_PLAYER_ID_PREFIX };
                    State.activePlayerElements = secretElements;
                    State.activePlayerType = 'secret';
                    
                    PlayerManager.loadTrack(secretElements, songDataWithTheme, themeForSecret);
                    PlayerManager.setupEventListeners(secretElements, 'secret', State.activePlayerConfig);
                    PlayerManager.setActivePlayerAnimated(secretElements); 
                    
                    setTimeout(() => { 
                        if (secretElements.audio && secretElements.audio.paused) {
                            PlayerManager.togglePlayPause(secretElements);
                        }
                    }, 100); 
                }
                UIManager.applyCurrentDarkModeStyles();
            }
        };

        // --- YouTube Player ---
        const YouTubePlayer = {
            isAPIReady: false,
            activeVideoId: null, 
            shouldHaveAudio: false,

            init: () => {
                window.onYouTubeIframeAPIReady = () => {
                    YouTubePlayer.isAPIReady = true;
                    if (Cache.youtubeVideoOverlay.style.display === 'flex' && YouTubePlayer.activeVideoId && !State.youtubePlayer) {
                        YouTubePlayer.createPlayer(YouTubePlayer.activeVideoId, YouTubePlayer.shouldHaveAudio);
                    }
                };
            },
            // MODIFIED: showVideoById to accept videoId and withAudio flag
            showVideoById: (videoId, withAudio = false) => {
                YouTubePlayer.activeVideoId = videoId;
                YouTubePlayer.shouldHaveAudio = withAudio;

                if (Cache.youtubeVideoOverlay) {
                    Cache.youtubeVideoOverlay.style.display = 'flex';
                    Cache.body.classList.add('youtube-video-active'); // Disable interaction on other elements

                    if (!YouTubePlayer.isAPIReady || typeof YT === 'undefined' || typeof YT.Player === 'undefined') {
                         console.warn("YouTube API not ready, deferring player creation.");
                         return; 
                    }
                    YouTubePlayer.createPlayer(videoId, withAudio);
                }
            },
            // MODIFIED: createPlayer to accept videoId and withAudio flag
            createPlayer: (videoId, withAudio = false) => {
                if (Cache.youtubeVideoOverlay.style.display === 'none' || Cache.youtubeVideoOverlay.style.display === '') return;
                
                if (State.youtubePlayer && typeof State.youtubePlayer.destroy === 'function') {
                    try { State.youtubePlayer.destroy(); } catch (e) { console.warn("YT Player destroy error", e); }
                }
                Cache.youtubePlayerContainer.innerHTML = ''; 
                const playerDiv = document.createElement('div');
                playerDiv.id = 'yt-player-actual'; 
                Cache.youtubePlayerContainer.appendChild(playerDiv);

                State.youtubePlayer = new YT.Player(playerDiv.id, {
                    height: '100%', width: '100%', videoId: videoId,
                    playerVars: { 
                        'autoplay': 1, 'controls': 0, 'showinfo': 0, 'rel': 0, 
                        'loop': 1, 'playlist': videoId, 
                        'modestbranding': 1, 'iv_load_policy': 3, 'fs': 0, 'playsinline': 1 
                    },
                    events: {
                        'onReady': (event) => YouTubePlayer.onPlayerReady(event, withAudio), // Pass audio flag
                        'onStateChange': YouTubePlayer.onPlayerStateChange
                    }
                });
            },
            // MODIFIED: onPlayerReady to handle audio
            onPlayerReady: (event, withAudio) => {
                event.target.playVideo();
                if (withAudio) {
                    event.target.unMute(); 
                } else {
                    event.target.mute(); 
                }
                const iframe = event.target.getIframe();
                if (iframe) { 
                    Object.assign(iframe.style, { position:'absolute', top:'0', left:'0', width:'100%', height:'100%' });
                }
            },
            onPlayerStateChange: (event) => {
                if (event.data === YT.PlayerState.ENDED) { 
                    State.youtubePlayer.seekTo(0);
                    State.youtubePlayer.playVideo();
                }
            },
            // Not used as user wants to be stuck, but good to have for future
            
            hideVideo: () => {
                if (Cache.youtubeVideoOverlay) {
                    Cache.youtubeVideoOverlay.style.display = 'none';
                }
                Cache.body.classList.remove('youtube-video-active');
                if (State.youtubePlayer && typeof State.youtubePlayer.stopVideo === 'function') {
                    State.youtubePlayer.stopVideo();
                }
                 if (State.youtubePlayer && typeof State.youtubePlayer.destroy === 'function') {
                    try { State.youtubePlayer.destroy(); } catch (e) { console.warn("YT Player destroy error on hide", e); }
                    State.youtubePlayer = null;
                }
                YouTubePlayer.activeVideoId = null;
                YouTubePlayer.shouldHaveAudio = false;
            }
            
        };
        
        YouTubePlayer.init(); 

        const LocalVideoManager = {
            showPlayer: (videoSrc) => {
                if (!Cache.localVideoOverlay || !Cache.localVideoPlayerElement || !State.is328TriggerEnabled) return;

                Cache.localVideoOverlay.style.display = 'flex';
                Cache.localVideoPlayerElement.src = videoSrc;
                Cache.localVideoPlayerElement.play()
                    .then(() => {
                         Cache.body.classList.add('local-video-active');
                         // Listener untuk klik di mana saja untuk menutup video
                         document.addEventListener('click', LocalVideoManager.handleDocumentClickToHide, { once: true, capture: true });
                         // Listener untuk tombol Escape
                         document.addEventListener('keydown', LocalVideoManager.handleEscapeKeyToHide, { once: true });
                    })
                    .catch(e => {
                        console.error("Error playing local video:", e);
                        Cache.localVideoOverlay.style.display = 'none'; // Sembunyikan jika gagal play
                    });
            },

            

            hidePlayer: () => {
                if (!Cache.localVideoOverlay || !Cache.localVideoPlayerElement) return;

                Cache.localVideoOverlay.style.display = 'none';
                Cache.localVideoPlayerElement.pause();
                Cache.localVideoPlayerElement.src = ''; // Kosongkan sumber video

                State.is328TriggerEnabled = false; // Nonaktifkan pemicu 328 secara permanen
                console.log("Pemicu video 328 telah dinonaktifkan permanen.");

                Cache.body.classList.remove('local-video-active');

                // Hapus listener yang sudah terpasang (meskipun {once: true} akan menghapusnya otomatis setelah dieksekusi)
                document.removeEventListener('click', LocalVideoManager.handleDocumentClickToHide, { capture: true });
                document.removeEventListener('keydown', LocalVideoManager.handleEscapeKeyToHide);
            },

            handleDocumentClickToHide: (event) => {
                // Jika klik berasal dari dalam kontrol video, jangan langsung tutup.
                // Ini adalah penyederhanaan, karena mendeteksi klik pada native controls bisa rumit.
                // Untuk kasus "klik apapun", kita bisa langsung memanggil hidePlayer.
                // if (Cache.localVideoPlayerElement.contains(event.target)) {
                //    document.addEventListener('click', LocalVideoManager.handleDocumentClickToHide, { once: true, capture: true });
                //    return;
                // }
                LocalVideoManager.hidePlayer();
            },

            handleEscapeKeyToHide: (event) => {
                if (event.key === 'Escape') {
                    LocalVideoManager.hidePlayer();
                } else {
                    // Jika bukan Escape, pasang lagi listener untuk keydown berikutnya
                    document.addEventListener('keydown', LocalVideoManager.handleEscapeKeyToHide, { once: true });
                }
            }
        };

        // --- Calendar Manager ---
        const CalendarManager = {
            init: () => {
                if (Cache.calendarToggleButton) {
                    Cache.calendarToggleButton.addEventListener('click', CalendarManager.toggleCalendar);
                }
                if (Cache.calendarHeaderPrevBtn) {
                    Cache.calendarHeaderPrevBtn.addEventListener('click', () => CalendarManager.changeMonth(-1));
                }
                if (Cache.calendarHeaderNextBtn) {
                    Cache.calendarHeaderNextBtn.addEventListener('click', () => CalendarManager.changeMonth(1));
                }
                CalendarManager.renderCalendar();
                // Sembunyikan jika klik di luar kalender (jika terlihat)
                document.addEventListener('click', (event) => {
                    if (State.isCalendarVisible && Cache.calendarPopup && !Cache.calendarPopup.contains(event.target) && !Cache.calendarToggleButton.contains(event.target)) {
                        CalendarManager.hideCalendar();
                    }
                });
            },

            toggleCalendar: () => {
                State.isCalendarVisible = !State.isCalendarVisible;
                if (State.isCalendarVisible) {
                    Cache.calendarPopup.style.display = 'flex'; // atau block
                    // force reflow
                    void Cache.calendarPopup.offsetWidth;
                    Cache.calendarPopup.classList.add('visible');
                    CalendarManager.renderCalendar(); // Render ulang saat buka
                } else {
                    CalendarManager.hideCalendar();
                }
            },

            hideCalendar: () => {
                if (Cache.calendarPopup) {
                    Cache.calendarPopup.classList.remove('visible');
                    // Biarkan transisi opacity selesai sebelum display none
                    setTimeout(() => {
                         if (!State.isCalendarVisible) Cache.calendarPopup.style.display = 'none';
                    }, 300); // Sama dengan durasi transisi
                }
                State.isCalendarVisible = false;
                 if(Cache.calendarMessageDisplay) Cache.calendarMessageDisplay.textContent = ''; // Bersihkan pesan saat ditutup
            },

            renderCalendar: () => {
                if (!Cache.calendarDaysContainer || !Cache.calendarMonthYearText) return;

                Cache.calendarDaysContainer.innerHTML = ''; // Clear previous days

                const year = State.currentCalendarDate.getFullYear();
                const month = State.currentCalendarDate.getMonth(); // 0-11

                Cache.calendarMonthYearText.textContent = `${State.currentCalendarDate.toLocaleString('id-ID', { month: 'long' })} ${year}`;

                const firstDayOfMonth = new Date(year, month, 1).getDay(); // 0 (Minggu) - 6 (Sabtu)
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                
                const dayAbbreviations = ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'];
                dayAbbreviations.forEach(dayAbbr => {
                    const dayHeaderEl = document.createElement('div');
                    dayHeaderEl.classList.add('weekday-header');
                    dayHeaderEl.textContent = dayAbbr;
                    Cache.calendarDaysContainer.appendChild(dayHeaderEl);
                });

                // Add empty cells for days before the first of the month
                for (let i = 0; i < firstDayOfMonth; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.classList.add('empty');
                    Cache.calendarDaysContainer.appendChild(emptyCell);
                }

                // Add day cells
                const today = new Date();
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayCell = document.createElement('div');
                    dayCell.textContent = day;
                    dayCell.dataset.day = day;
                    dayCell.dataset.month = month; // bulan (0-11)
                    dayCell.dataset.year = year;

                    if (year === today.getFullYear() && month === today.getMonth() && day === today.getDate()) {
                        dayCell.classList.add('today');
                    }
                    
                    dayCell.addEventListener('click', CalendarManager.handleDayClick);
                    Cache.calendarDaysContainer.appendChild(dayCell);
                }
            },

            changeMonth: (offset) => {
                State.currentCalendarDate.setMonth(State.currentCalendarDate.getMonth() + offset);
                CalendarManager.renderCalendar();
                 if(Cache.calendarMessageDisplay) Cache.calendarMessageDisplay.textContent = ''; // Bersihkan pesan saat ganti bulan
            },

            displayCalendarMessage: (message) => {
                if (!Cache.calendarMessageDisplay) return;
                Cache.calendarMessageDisplay.textContent = message;

                if (State.calendarMessageTimeoutId) {
                    clearTimeout(State.calendarMessageTimeoutId);
                }
                State.calendarMessageTimeoutId = setTimeout(() => {
                    Cache.calendarMessageDisplay.textContent = '';
                }, 5000); // Pesan hilang setelah 5 detik
            },

            handleDayClick: (event) => {
                const day = parseInt(event.target.dataset.day);
                const month = parseInt(event.target.dataset.month); // bulan (0-11)
                const year = parseInt(event.target.dataset.year);
                
                // Tandai tanggal yang diklik
                document.querySelectorAll('#calendar-days div.selected').forEach(el => el.classList.remove('selected'));
                event.target.classList.add('selected');

                // Pemicu spesifik tanggal
                // Ingat bulan di JS adalah 0-indexed (Jan=0, Feb=1, Mar=2, Apr=3, ..., Dec=11)
                
                // 28 Maret
                if (day === 28 && month === 2) { // 28 Maret
                    CalendarManager.displayCalendarMessage("Mengarahkan...");
                    setTimeout(() => { window.open('https://codei81224.vercel.app/', '_blank'); }, 1000);
                } 
                else if (day === 8 && month === 11) { // 8 Desember
                    CalendarManager.displayCalendarMessage("Timernya belum abis awokawok üòé");
                } 
                else if (day === 15 && month === 1) { // 15 Februari
                    CalendarManager.displayCalendarMessage("üéÇ Selamat ulang tahun, semoga harimu secerah senyumnya!");
                }
                else if (day === 16 && month === 1) { // 16 Februari
                     CalendarManager.displayCalendarMessage("Selamat ulang tahun di alam sana... doa terbaik selalu menyertai. üôè");
                }
                else if (day === 11 && month === 11) { // 11 Desember
                    CalendarManager.displayCalendarMessage("Wih, belum mokad juga? ü§î Panjang umur, ya!");
                }
                else if (day === 28 && month === 3) { // 28 April
                     CalendarManager.displayCalendarMessage("Fakta terungkap: Netizen Indonesia... ah sudahlah, mereka adalah sekumpulan orang bodoh! üéâ");
                }
                else if (day === 29 && month === 1) { // 29 Februari
                     CalendarManager.displayCalendarMessage("CODEI 81224 TELAH LAHIR DI DUNIA FANA INI! ü•≥");
                }
                // --- TAMBAHAN BARU ---
                else if (day === 28 && month === 7) { // 28 Agustus (Agustus adalah bulan ke-7)
                    CalendarManager.displayCalendarMessage("Chat terakhirku bersamanya...");
                }
                else if (day === 28 && month === 4) { // 28 Mei (Mei adalah bulan ke-4)
                    CalendarManager.displayCalendarMessage("Mimpi yang mengingatkanku tentang ia...");
                }
                else if (day === 1 && month === 8) { // 1 September (September adalah bulan ke-8)
                    CalendarManager.displayCalendarMessage("Rumah baru dengan kehidupan baru. Menghindarlah para pengacau!");
                }
                else if (day === 16 && month === 2) { // 16 Maret (Maret adalah bulan ke-2)
                    CalendarManager.displayCalendarMessage("Tanggal yang sering dianggap sial.");
                }
                else if (day === 3 && month === 5) { // 3 Juni (Juni adalah bulan ke-5)
                    CalendarManager.displayCalendarMessage("Kode yang pas untuk membuka dekripsi!");
                }
                else if (day === 17 && month === 7) { // 17 Agustus
                    CalendarManager.displayCalendarMessage("Disinilah merdekanya penerus pengacau!");
                }
                else if (day === 12 && month === 7) { // 12 Agustus
                    const longMessage = `QmFueWFrIHNla2FsaSBsdWthIHlhbmcgdGVsYWgga3VqYWxhbmkgc2VuZGlyaSwgZGFsYW0gZGlhbS4gQXBhIHNlYmVuYXJueWEgdHVqdWFuIG1lcmVrYSBtZW1iZW5jaT8gQXBha2FoIG1lcmVrYSBtZXJhc2EgcHVhcyBzZXRlbGFoIG1lbmdoYW5jdXJrYW4gc2VzZW9yYW5nPyBBa3UgcmFzYSB0aWRhay4gTWVyZWthIGhhbnlhIGluZ2luIG1lbGloYXQgZGlyaW55YSBwZXJsYWhhbiBwYWRhbSwgc2VwZXJ0aSBsaWxpbiBkaSB0ZW5nYWggYmFkYWkuCgpLZW5hcGEgc2VtdWEgaW5pIHRhayBwZXJuYWggdXNhaT8gU2VsYW1hIGhpZHVwbnlhLCBpYSBzZWxhbHUgcGVyY2F5YSBwYWRhIGNhaGF5YSBrZWNpbCBkaSBkZXBhbiBtYXRhbnlhLCBtZXNraSBpdHUgaGFueWEgaWx1c2kuIE1lbmdhcGEgbWVyZWthIGJlZ2l0dSBtZW1iZW5jaSBkYW4gbWVyYXNhIHRlcmFuY2FtIG9sZWhueWE/IFBhZGFoYWwsIGlhIGFkYWxhaCBqaXdhIHlhbmcgcGFsaW5nIHR1bHVzIHlhbmcgcGVybmFoIGt1dGVtdWksIG1hbXB1IG1lbnllbnR1aCBwZXJhc2FhbiBoYW55YSBkZW5nYW4gaGFkaXJueWEuCgpMYWx1LCBzZXRlbGFoIHNlbXVhIGluaSB0ZXJqYWRpLCBhcGEgeWFuZyB0ZXJzaXNhPyBCYWdhaW1hbmEgYWt1IGJpc2EgYmVybmFwYXMgdGFucGEgZGlyaW55YT8gRGluZ2luLCBzZXBlcnRpIHRhbmFoIG1ha2FtIHlhbmcgYmFydSBkaWdhbGkuIFNlcGVydGkgYXBhIHJhc2FueWE/IFNlcGVydGkgaGFsYW1hbiBraXRhYiBzdWNpIHlhbmcgaGFuZ3VzIGRhbiBtZW5naGl0YW0sIGRpYmFrYXIgYXBpLgoKU2lhLXNpYSBzZWdhbGFueWEuIFByb3llayB5YW5nIGt1YmFuZ3VuIGRhcmkgaGFyYXBhbi4gSGFkaWFoIHlhbmcga3VzaWFwa2FuIGRpYW0tZGlhbS4gUGVzYW4ga2VoaWR1cGFuIHlhbmcga2luaSB0ZXJrdWJ1ciB0YW5wYSBtYWtuYS4gTWVyZWthIGxpaGFpIG1lbXV0YXJiYWxpa2thbiBzZWdhbGFueWEsIHNlZGFuZ2thbiBrYW1pLCB5YW5nIHRhayBwdW55YSBrdWFzYSBhcGEgcHVuLCBoYW55YSBiaXNhIGRpaGluYSBkYW4gZGlsdXBha2FuLgoKTWFhZmthbiBha3Uga2FyZW5hIHRlbGFoIGdhZ2FsIGRhbGFtIHNlZ2FsYW55YS4gR2FnYWwgbWVuamFkaSBwZWxpbmR1bmcuIEdhZ2FsIG1lbmphZGkgdGVtYW4uIEdhZ2FsIG1lbmphZGkgYWxhc2FuIHVudHVrIGlhIHRldGFwIHRpbmdnYWwuIE11bmdraW4sIHR1anVoIHRhaHVuIGJlcnNhbWFueWEgY3VrdXAgbWVuamFkaSBiYWIgdGVyc2VkaWggZGFsYW0gbWFzYSBrZWNpbGt1LCBhdGF1IHJlbWFqYWt1LiBBa3Ugc2VuZGlyaSB0YWsgdGFodS4gWWFuZyBqZWxhcywgcGVyY2ludGFhbiBpdHUgYmFuZ3NhdCwgZGFuIGFrdSBiZW5hci1iZW5hciBtZW55ZXNhbC4=`;
                    CalendarManager.displayCalendarMessage(longMessage);
                }
                else if (day === 30 && month === 10) { // 30 November (November adalah bulan ke-10)
                     CalendarManager.displayCalendarMessage("Mimpi kedua tentangnya...");
                }
                else if (day === 11 && month === 4) { // 11 Mei
                    CalendarManager.displayCalendarMessage("Urutan kalkulator yang membuka sesuatu...");
                }
                // --- AKHIR TAMBAHAN BARU ---
                else {
                    if (Cache.calendarMessageDisplay) Cache.calendarMessageDisplay.textContent = '';
                }
            }
        };

        // --- Secret Triggers Management ---
        const SecretManager = {
            handleTrigger: (key) => {
                if (SECRET_SONG_TRIGGERS[key]) {
                    SECRET_SONG_TRIGGERS[key].count++;
                    for (const k in SECRET_SONG_TRIGGERS) {
                        if (k !== key) SECRET_SONG_TRIGGERS[k].count = 0;
                    }
                    State.calcMultiplyClicks = 0; 
                    State.calcDivideClicks = 0;

                    if (SECRET_SONG_TRIGGERS[key].count >= SECRET_SONG_TRIGGERS[key].threshold) {
                        PlayerManager.playSecretSong(SECRET_SONG_TRIGGERS[key].song);
                        SECRET_SONG_TRIGGERS[key].count = 0; 
                    }
                }
            }
        };

        // --- Event Listener Setup ---
        const setupEventListeners = () => {
            if (Cache.startStoryButton) {
                Cache.startStoryButton.addEventListener('click', () => {
                    if (Cache.introSection) {
                        Cache.introSection.classList.add('is-exiting');
                        if (Cache.darkModeToggleButton) Cache.darkModeToggleButton.style.display = 'flex';
                        
                        const handleIntroTransitionEnd = () => {
                            Cache.introSection.style.display = 'none';
                            Cache.introSection.removeEventListener('transitionend', handleIntroTransitionEnd);

                            if (Cache.mainContent) {
                                Cache.mainContent.style.display = 'block'; 
                                Cache.mainContent.classList.add('is-entering');
                                UIManager.setWidgetVisibility(true); 
                                UIManager.applyCurrentDarkModeStyles(); 
                                SecretMessageManager.startLoop();
                            }
                            if (Cache.nextButtonMainPage) UIManager.startButtonTimer(Cache.nextButtonMainPage, 480); 
                        };
                        Cache.introSection.addEventListener('transitionend', handleIntroTransitionEnd);
                    }
                });
            }

            if (Cache.nextButtonMainPage) {
                Cache.nextButtonMainPage.addEventListener('click', () => {
                    if (!Cache.nextButtonMainPage.disabled) {
                         window.location.href = 'https://codei81224.vercel.app/';
                    }
                });
            }

            if (Cache.calcButtonsContainer) {
                Cache.calcButtonsContainer.addEventListener('click', (e) => {
                    const button = e.target.closest('button');
                    if (!button) return;

                    button.classList.add('pressed-animation');
                    button.addEventListener('animationend', () => {
                        button.classList.remove('pressed-animation');
                    }, { once: true });

                    const value = button.textContent.trim();
                    Calculator.handleInput(value); // This now handles 666 and 777 internally

                    if (value === '*') {
                        State.calcMultiplyClicks++; State.calcDivideClicks = 0;
                        for (const k in SECRET_SONG_TRIGGERS) SECRET_SONG_TRIGGERS[k].count = 0; 
                        if (State.calcMultiplyClicks >= 24) {
                            PlayerManager.playSecretSong({ title: "653 √ó 5 - 0.5", artist: "Adzan", src: "sweet.mp3", theme: { color: 'black', glow: '#444', playerBoxBg: 'rgba(20,20,20,0.85)', playerBoxText: 'white', seekBarThumb: '#E0E0E0', mainTextColor: 'white', logoSpin: 'spin-secret-song-player' }});
                            State.calcMultiplyClicks = 0;
                        }
                    } else if (value === '/') {
                        State.calcDivideClicks++; State.calcMultiplyClicks = 0;
                        for (const k in SECRET_SONG_TRIGGERS) SECRET_SONG_TRIGGERS[k].count = 0;
                        if (State.calcDivideClicks >= 24) {
                             PlayerManager.playSecretSong({ title: "Fufufafa fufufafa fufuf", artist: "Adzan", src: "morse.mp3", theme: {color: 'linear-gradient(to right, #FF0000, #FF7F00, #FFFF00, #00FF00, #0000FF, #4B0082, #8B00FF)', glow: 'rgba(255,255,255,0.4)', playerBoxBg: 'rgba(0,0,0,0.45)', playerBoxText: 'white', seekBarThumb: 'white', mainTextColor: 'white', logoSpin: 'spin-secret-song-player' }});
                            State.calcDivideClicks = 0;
                        }
                    } else if (value === 'C') { 
                        State.calcMultiplyClicks = 0; State.calcDivideClicks = 0; 
                        SecretManager.handleTrigger('clearCalc');
                    } else if (value === '.') {
                        SecretManager.handleTrigger('dotCalc');
                    } else if (isNaN(parseFloat(value))) { // If it's an operator, not a number
                        State.calcMultiplyClicks = 0; State.calcDivideClicks = 0;
                        // Reset 666/777 sequences if an operator is pressed
                        State.calcInputSequence666 = [];
                        State.calcInputSequence777 = [];
                    }
                });
            }

            if (Cache.dateTimeLogo) {
                Cache.dateTimeLogo.addEventListener('click', () => {
                    State.dateTimeLogoClickCount++;

                    // Apply new unique animation on each click, unless the scary effect is active/about to be
                    if (!State.isScaryEffectActive && State.dateTimeLogoClickCount < 5) {
                        Cache.dateTimeLogo.classList.add('date-time-animate');
                        Cache.dateTimeLogo.addEventListener('animationend', () => {
                            Cache.dateTimeLogo.classList.remove('date-time-animate');
                        }, { once: true });
                    }
                    
                    if (State.dateTimeLogoClickCount >= 5 && !State.isScaryEffectActive) { 
                        Effects.triggerScaryEffectDateTime(); // This function resets count internally after timeout
                    }
                    SecretManager.handleTrigger('dateTime');
                });
            }

            if (Cache.darkModeToggleButton) {
                Cache.darkModeToggleButton.addEventListener('click', Utils.debounce(UIManager.toggleDarkMode, 150));
            }
        };

        // --- Initialization ---
        const init = () => {
            try {
                if (localStorage.getItem('darkMode') === 'enabled') {
                    Cache.body.classList.add('dark-mode');
                }
            } catch (e) { console.warn("Could not access localStorage for dark mode.", e); }
            
            UIManager.applyCurrentDarkModeStyles(); 

            if (Cache.introSection && getComputedStyle(Cache.introSection).display !== 'none') {
                if (Cache.darkModeToggleButton) Cache.darkModeToggleButton.style.display = 'none';
                UIManager.setWidgetVisibility(false);
            } else { 
                if (Cache.darkModeToggleButton) Cache.darkModeToggleButton.style.display = 'flex';
                UIManager.setWidgetVisibility(true);
                 if (Cache.mainContent) {
                    Cache.mainContent.style.display = 'block'; 
                    Cache.mainContent.classList.add('is-entering'); 
                 }
                 if (Cache.nextButtonMainPage) UIManager.startButtonTimer(Cache.nextButtonMainPage, 480);
            }

            if (Cache.dateTimeLogo && !Cache.dateTimeLogo.querySelector('#date-time-label')) {
                 const dateLabel = document.createElement('div');
                 dateLabel.id = 'date-time-label';
                 dateLabel.textContent = "8 December 2024"; 
                 Cache.dateTimeLogo.prepend(dateLabel);
            }

            if (PLAYERS_DATA.length > 0) {
                PlayerManager.switchToPlayer(0, 'main');
            } else {
                console.warn("No player data found. Music players will not be initialized.");
            }

            if (Cache.fireBackground) setInterval(UIManager.createFireNumber, 250); 
            if (Cache.countdownElement) {
                UIManager.updateMainCountdown(); 
                setInterval(UIManager.updateMainCountdown, 1000);
            }
            
            Effects.preventScreenshotAndRecording();
            setTimeout(UIManager.showScaryOverlayText, 12000); 

            if (typeof chroma !== 'function') {
                console.warn("Chroma.js library is not loaded. Some dynamic color functionalities might be affected.");
            }

            SecretMessageManager.init(); // Tambahkan ini
            CalendarManager.init(); 
            
            setupEventListeners();
            console.log("Aether's site initialized with modifications.");
        };

        init(); 
    });
  </script>
</body>
</html>